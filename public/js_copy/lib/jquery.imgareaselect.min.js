jQuery.imgAreaSelect={onKeyPress:null};jQuery.imgAreaSelect.init=function(l,G){var e=jQuery("<div></div>"),r=jQuery("<div></div>"),Ad=jQuery("<div></div>"),E=jQuery("<div></div>"),T=jQuery("<div></div>"),D=jQuery("<div></div>"),Aj=jQuery("<div></div>"),Ah,a,Al,c,i,s,Am,K,S,Ak=0,J,o,Ai,Z,N,M,R=10,k=[],h=0,j=1,g,Ao,f,W,B,X,C,u,v,An={x1:0,y1:0,x2:0,y2:0,width:0,height:0};var z=e.add(r).add(Ad);var O=E.add(T).add(D).add(Aj);function n(H){return H+Al.left+K.left-Am.left}function m(H){return H+Al.top+K.top-Am.top}function b(H){return H-Al.left-K.left+Am.left}function P(H){return H-Al.top-K.top+Am.top}function Ab(H){return H.pageX+K.left-Am.left}function Ac(H){return H.pageY+K.top-Am.top}function Y(){Al=jQuery(l).offset();c=jQuery(l).width();i=jQuery(l).height();if(jQuery(s).is("body")){Am=K={left:0,top:0}}else{Am=jQuery(s).offset();K={left:s.scrollLeft,top:s.scrollTop}}Ah=n(0);a=m(0)}function I(H){z.css({left:n(An.x1)+"px",top:m(An.y1)+"px",width:Math.max(An.width-G.borderWidth*2,0)+"px",height:Math.max(An.height-G.borderWidth*2,0)+"px"});E.css({left:Ah+"px",top:a+"px",width:An.x1+"px",height:i+"px"});T.css({left:Ah+An.x1+"px",top:a+"px",width:An.width+"px",height:An.y1+"px"});D.css({left:Ah+An.x2+"px",top:a+"px",width:c-An.x2+"px",height:i+"px"});Aj.css({left:Ah+An.x1+"px",top:a+An.y2+"px",width:An.width+"px",height:i-An.y2+"px"});if(H!==false){if(jQuery.imgAreaSelect.keyPress!=Aa){jQuery(document).unbind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress)}if(G.keys){jQuery(document).bind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress=Aa)}}}function F(H){if(!S){Y();S=true;z.one("mouseout",function(){S=false})}u=b(Ab(H))-An.x1;v=P(Ac(H))-An.y1;k=[];if(G.resizable){if(v<=R){k[h]="n"}else{if(v>=An.height-R){k[h]="s"}}if(u<=R){k[j]="w"}else{if(u>=An.width-R){k[j]="e"}}}Ad.css("cursor",k.length?k.join("")+"-resize":G.movable?"move":"")}function Ag(H){if(H.which!=1){return false}Y();if(G.resizable&&k.length>0){jQuery("body").css("cursor",k.join("")+"-resize");W=n(k[j]=="w"?An.x2:An.x1);X=m(k[h]=="n"?An.y2:An.y1);jQuery(document).mousemove(t);Ad.unbind("mousemove",F);jQuery(document).one("mouseup",function(){k=[];jQuery("body").css("cursor","");if(G.autoHide){z.add(O).hide()}G.onSelectEnd(l,An);jQuery(document).unbind("mousemove",t);Ad.mousemove(F)})}else{if(G.movable){N=An.x1+Ah;M=An.y1+a;Ai=Ab(H);Z=Ac(H);jQuery(document).mousemove(p).one("mouseup",function(){G.onSelectEnd(l,An);jQuery(document).unbind("mousemove",p)})}else{jQuery(l).mousedown(H)}}return false}function Af(){B=Math.max(Ah,Math.min(Ah+c,W+Math.abs(C-X)*f*(B>=W?1:-1)));C=Math.round(Math.max(a,Math.min(a+i,X+Math.abs(B-W)/f*(C>=X?1:-1))));B=Math.round(B)}function Q(){C=Math.max(a,Math.min(a+i,X+Math.abs(B-W)/f*(C>=X?1:-1)));B=Math.round(Math.max(Ah,Math.min(Ah+c,W+Math.abs(C-X)*f*(B>=W?1:-1))));C=Math.round(C)}function U(V,H){B=V;C=H;if(G.minWidth&&Math.abs(B-W)<G.minWidth){B=W-G.minWidth*(B<W?1:-1);if(B<Ah){W=Ah+G.minWidth}else{if(B>Ah+c){W=Ah+c-G.minWidth}}}if(G.minHeight&&Math.abs(C-X)<G.minHeight){C=X-G.minHeight*(C<X?1:-1);if(C<a){X=a+G.minHeight}else{if(C>a+i){X=a+i-G.minHeight}}}B=Math.max(Ah,Math.min(B,Ah+c));C=Math.max(a,Math.min(C,a+i));if(f){if(Math.abs(B-W)/f>Math.abs(C-X)){Q()}else{Af()}}if(G.maxWidth&&Math.abs(B-W)>G.maxWidth){B=W-G.maxWidth*(B<W?1:-1);if(f){Q()}}if(G.maxHeight&&Math.abs(C-X)>G.maxHeight){C=X-G.maxHeight*(C<X?1:-1);if(f){Af()}}An.x1=b(Math.min(W,B));An.x2=b(Math.max(W,B));An.y1=P(Math.min(X,C));An.y2=P(Math.max(X,C));An.width=Math.abs(B-W);An.height=Math.abs(C-X);I();G.onSelectChange(l,An)}function t(H){B=!k.length||k[j]||f?Ab(H):n(An.x2);C=!k.length||k[h]||f?Ac(H):m(An.y2);U(B,C);return false}function q(H,V){B=(W=H)+An.width;C=(X=V)+An.height;An.x1=b(W);An.y1=P(X);An.x2=b(B);An.y2=P(C);I();G.onSelectChange(l,An)}function p(V){var H=Math.max(Ah,Math.min(N+Ab(V)-Ai,Ah+c-An.width));var d=Math.max(a,Math.min(M+Ac(V)-Z,a+i-An.height));q(H,d);V.preventDefault();return false}function L(H){Y();An.x1=An.x2=b(Ai=W=B=Ab(H));An.y1=An.y2=P(Z=X=C=Ac(H));An.width=0;An.height=0;k=[];I();z.add(O).show();jQuery(document).unbind("mouseup",A).mousemove(t);Ad.unbind("mousemove",F);G.onSelectStart(l,An);jQuery(document).one("mouseup",function(){if(G.autoHide||(An.width*An.height==0)){z.add(O).hide()}G.onSelectEnd(l,An);jQuery(document).unbind("mousemove",t);Ad.mousemove(F)})}function A(){jQuery(document).unbind("mousemove",L);z.add(O).hide()}function Ae(H){if(H.which!=1){return false}jQuery(document).one("mousemove",L).one("mouseup",A);return false}function w(){Y();I(false);W=n(An.x1);X=m(An.y1);B=n(An.x2);C=m(An.y2)}var Aa=function(x){var Ap=G.keys,V=10,y,H=x.keyCode||x.which;if(!isNaN(Ap.arrows)){V=Ap.arrows}if(!isNaN(Ap.shift)&&x.shiftKey){V=Ap.shift}if(!isNaN(Ap.ctrl)&&x.ctrlKey){V=Ap.ctrl}if(!isNaN(Ap.alt)&&(x.altKey||x.originalEvent.altKey)){V=Ap.alt}if(Ap.arrows=="resize"||(Ap.shift=="resize"&&x.shiftKey)||(Ap.ctrl=="resize"&&x.ctrlKey)||(Ap.alt=="resize"&&(x.altKey||x.originalEvent.altKey))){switch(H){case 37:V=-V;case 39:y=Math.max(W,B);W=Math.min(W,B);B=Math.max(y+V,W);if(f){Q()}break;case 38:V=-V;case 40:y=Math.max(X,C);X=Math.min(X,C);C=Math.max(y+V,X);if(f){Af()}break;default:return}U(B,C)}else{W=Math.min(W,B);X=Math.min(X,C);switch(H){case 37:q(Math.max(W-V,Ah),X);break;case 38:q(W,Math.max(X-V,a));break;case 39:q(W+Math.min(V,c-b(B)),X);break;case 40:q(W,X+Math.min(V,i-P(C)));break;default:return}}return false};this.setOptions=function(H){G=jQuery.extend(G,H);if(H.x1!=null){An.x1=H.x1;An.y1=H.y1;An.x2=H.x2;An.y2=H.y2;H.show=true}if(H.keys){G.keys=jQuery.extend({shift:1,ctrl:"resize"},H.keys===true?{}:H.keys)}s=jQuery(G.parent).get(0);Y();o=jQuery(l);while(o.length&&!o.is("body")){if(!isNaN(o.css("z-index"))&&o.css("z-index")>Ak){Ak=o.css("z-index")}if(o.css("position")=="fixed"){J=true}o=o.parent()}W=n(An.x1);X=m(An.y1);B=n(An.x2);C=m(An.y2);An.width=B-W;An.height=C-X;I();if(H.hide){z.add(O).hide()}else{if(H.show){z.add(O).show()}}O.addClass(G.classPrefix+"-outer");e.addClass(G.classPrefix+"-selection");r.addClass(G.classPrefix+"-border1");Ad.addClass(G.classPrefix+"-border2");z.css({borderWidth:G.borderWidth+"px"});e.css({backgroundColor:G.selectionColor,opacity:G.selectionOpacity});r.css({borderStyle:"solid",borderColor:G.borderColor1});Ad.css({borderStyle:"dashed",borderColor:G.borderColor2});O.css({opacity:G.outerOpacity,backgroundColor:G.outerColor});f=G.aspectRatio&&(Ao=G.aspectRatio.split(/:/))?Ao[0]/Ao[1]:null;if(G.disable||G.enable===false){z.unbind("mousemove",F).unbind("mousedown",Ag);jQuery(l).add(O).unbind("mousedown",Ae);jQuery(window).unbind("resize",w)}else{if(G.enable||G.disable===false){if(G.resizable||G.movable){z.mousemove(F).mousedown(Ag)}if(!G.persistent){jQuery(l).add(O).mousedown(Ae)}jQuery(window).resize(w)}}jQuery(G.parent).append(O.add(z));G.enable=G.disable=undefined};if(jQuery.browser.msie){jQuery(l).attr("unselectable","on")}jQuery.imgAreaSelect.keyPress=jQuery.browser.msie||jQuery.browser.safari?"keydown":"keypress";z.add(O).css({display:"none",position:J?"fixed":"absolute",overflow:"hidden",zIndex:Ak>0?Ak:"0"});e.css({borderStyle:"solid"});initOptions={borderColor1:"#000",borderColor2:"#fff",borderWidth:1,classPrefix:"imgareaselect",movable:true,resizable:true,selectionColor:"#fff",selectionOpacity:0.2,outerColor:"#000",outerOpacity:0.2,parent:"body",onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}};G=jQuery.extend(initOptions,G);this.setOptions(G)};jQuery.fn.imgAreaSelect=function(A){A=A||{};this.each(function(){if(jQuery(this).data("imgAreaSelect")){jQuery(this).data("imgAreaSelect").setOptions(A)}else{if(A.enable===undefined&&A.disable===undefined){A.enable=true}jQuery(this).data("imgAreaSelect",new jQuery.imgAreaSelect.init(this,A))}});return this};