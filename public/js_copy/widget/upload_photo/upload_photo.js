require(["jquery","webuploader"],function(C,B){function A(){var D=C(this);C(".js-photo_name")[0].disabled=D[0].checked?!0:!1}console.log(B),C(".js-form_photo .js-check-isAblum").on("click",A),C(function(){function J(d){var e=C('<li id="'+d.id+'"><p class="title">'+d.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),Y=C('<div class="file-panel"><span class="cancel">删除</span><span class="rotateRight">向右旋转</span><span class="rotateLeft">向左旋转</span></div>').appendTo(e),a=e.find("p.progress span"),Z=e.find("p.imgWrap"),c=C('<p class="error"></p>'),b=function(f){switch(f){case"exceed_size":text="文件大小超出";break;case"interrupt":text="上传暂停";break;default:text="上传失败，请重试"}c.text(text).appendTo(e)};"invalid"===d.getStatus()?b(d.statusText):(Z.text("预览中"),M.makeThumb(d,function(g,f){if(g){return void Z.text("不能预览")}var h=C('<img src="'+f+'">');Z.empty().append(h)},L,W),H[d.id]=[d.size,0],d.rotation=0),d.on("statuschange",function(f,g){"progress"===g?a.hide().width(0):"queued"===g&&(e.off("mouseenter mouseleave"),Y.remove()),"error"===f||"invalid"===f?(console.log(d.statusText),b(d.statusText),H[d.id][1]=1):"interrupt"===f?b("interrupt"):"queued"===f?H[d.id][1]=0:"progress"===f?(c.remove(),a.css("display","block")):"complete"===f&&e.append('<span class="success"></span>'),e.removeClass("state-"+g).addClass("state-"+f)}),e.on("mouseenter",function(){Y.stop().animate({height:30})}),e.on("mouseleave",function(){Y.stop().animate({height:0})}),Y.on("click","span",function(){var g,f=C(this).index();switch(f){case 0:return void M.removeFile(d);case 1:d.rotation+=90;break;case 2:d.rotation-=90}F?(g="rotate("+d.rotation+"deg)",Z.css({"-webkit-transform":g,"-mos-transform":g,"-o-transform":g,transform:g})):Z.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(d.rotation/90%4+4)%4+")")}),e.appendTo(I)}function N(Y){var Z=C("#"+Y.id);delete H[Y.id],O(),Z.off().find(".file-panel").off().end().remove()}function O(){var Y,b=0,Z=0,a=V.children();C.each(H,function(d,c){Z+=c[0],b+=c[0]*c[1]}),Y=Z?b/Z:0,a.eq(0).text(Math.round(100*Y)+"%"),a.eq(1).css("width",Math.round(100*Y)+"%"),D()}function D(){var Y,Z="";"ready"===T?Z="选中"+P+"张图片，共"+B.formatSize(U)+"。":"confirm"===T?(Y=M.getStats(),Y.uploadFailNum&&(Z="已成功上传"+Y.successNum+"张照片至XX相册，"+Y.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>')):(Y=M.getStats(),Z="共"+P+"张（"+B.formatSize(U)+"），已上传"+Y.successNum+"张",Y.uploadFailNum&&(Z+="，失败"+Y.uploadFailNum+"张")),E.html(Z)}function G(Z){var Y;if(Z!==T){switch(S.removeClass("state-"+T),S.addClass("state-"+Z),T=Z){case"pedding":K.removeClass("element-invisible"),I.hide(),Q.addClass("element-invisible"),M.refresh();break;case"ready":K.addClass("element-invisible"),C("#filePicker2").removeClass("element-invisible"),I.show(),Q.removeClass("element-invisible"),M.refresh();break;case"uploading":C("#filePicker2").addClass("element-invisible"),V.show(),S.text("暂停上传");break;case"paused":V.show(),S.text("继续上传");break;case"confirm":if(V.hide(),S.text("开始上传").addClass("disabled"),Y=M.getStats(),Y.successNum&&!Y.uploadFailNum){return void G("finish")}break;case"finish":Y=M.getStats(),Y.successNum?(alert("上传成功"),C(".js-form_photo")[0].submit()):(T="done",location.reload())}D()}}var M,X=C("#uploader"),I=C('<ul class="filelist"></ul>').appendTo(X.find(".queueList")),Q=X.find(".statusBar"),E=Q.find(".info"),S=X.find(".uploadBtn"),K=X.find(".placeholder"),V=Q.find(".progress").hide(),P=0,U=0,R=window.devicePixelRatio||1,L=110*R,W=110*R,T="pedding",H={},F=function(){var Z=document.createElement("p").style,Y="transition" in Z||"WebkitTransition" in Z||"MozTransition" in Z||"msTransition" in Z||"OTransition" in Z;return Z=null,Y}();M=B.create({pick:{id:"#filePicker",label:"点击选择图片"},dnd:"#dndArea",paste:"#uploader",swf:"../public/complexPlugin/webuploader/dist/Uploader.swf",chunked:!0,sendAsBinary:!0,server:uploadpath,fileNumLimit:300,fileSizeLimit:209715200,fileSingleSizeLimit:52428800}),M.addButton({id:"#filePicker2",label:"继续添加"}),M.onUploadProgress=function(a,Z){var b=C("#"+a.id),Y=b.find(".progress span");Y.css("width",100*Z+"%"),H[a.id][1]=Z,O()},M.onFileQueued=function(Y){P++,U+=Y.size,1===P&&(K.addClass("element-invisible"),Q.show()),J(Y),G("ready"),O()},M.onFileDequeued=function(Y){P--,U-=Y.size,P||G("pedding"),N(Y),O()},M.on("all",function(Y){switch(Y){case"uploadFinished":G("confirm");break;case"startUpload":G("uploading");break;case"stopUpload":G("paused")}}),M.onError=function(Y){alert("Eroor: "+Y)},S.on("click",function(){return C(this).hasClass("disabled")?!1:void ("ready"===T?M.upload():"paused"===T?M.upload():"uploading"===T&&M.stop())}),E.on("click",".retry",function(){M.retry()}),E.on("click",".ignore",function(){alert("todo")}),S.addClass("state-"+T),O()})});