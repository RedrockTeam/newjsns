require(["jquery","webuploader"],function(E,D){function F(){var A=E(this);E(".js-photo_name")[0].disabled=A[0].checked?!0:!1}console.log(D),E(".js-form_photo .js-check-isAblum").on("click",F),E(function(){function e(G){var H=E('<li id="'+G.id+'"><p class="title">'+G.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),L=E('<div class="file-panel"><span class="cancel">删除</span><span class="rotateRight">向右旋转</span><span class="rotateLeft">向左旋转</span></div>').appendTo(H),M=H.find("p.progress span"),I=H.find("p.imgWrap"),K=E('<p class="error"></p>'),J=function(N){switch(N){case"exceed_size":text="文件大小超出";break;case"interrupt":text="上传暂停";break;default:text="上传失败，请重试"}K.text(text).appendTo(H)};"invalid"===G.getStatus()?J(G.statusText):(I.text("预览中"),l.makeThumb(G,function(N,P){if(N){return void I.text("不能预览")}var O=E('<img src="'+P+'">');I.empty().append(O)},k,b),g[G.id]=[G.size,0],G.rotation=0),G.on("statuschange",function(O,N){"progress"===N?M.hide().width(0):"queued"===N&&(H.off("mouseenter mouseleave"),L.remove()),"error"===O||"invalid"===O?(console.log(G.statusText),J(G.statusText),g[G.id][1]=1):"interrupt"===O?J("interrupt"):"queued"===O?g[G.id][1]=0:"progress"===O?(K.remove(),M.css("display","block")):"complete"===O&&H.append('<span class="success"></span>'),H.removeClass("state-"+N).addClass("state-"+O)}),H.on("mouseenter",function(){L.stop().animate({height:30})}),H.on("mouseleave",function(){L.stop().animate({height:0})}),L.on("click","span",function(){var N,O=E(this).index();switch(O){case 0:return void l.removeFile(G);case 1:G.rotation+=90;break;case 2:G.rotation-=90}m?(N="rotate("+G.rotation+"deg)",I.css({"-webkit-transform":N,"-mos-transform":N,"-o-transform":N,transform:N})):I.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(G.rotation/90%4+4)%4+")")}),H.appendTo(h)}function i(H){var G=E("#"+H.id);delete g[H.id],j(),G.off().find(".file-panel").off().end().remove()}function j(){var I,H=0,G=0,J=a.children();E.each(g,function(K,L){G+=L[0],H+=L[0]*L[1]}),I=G?H/G:0,J.eq(0).text(Math.round(100*I)+"%"),J.eq(1).css("width",Math.round(100*I)+"%"),o()}function o(){var H,G="";"ready"===c?G="选中"+Y+"张图片，共"+D.formatSize(d)+"。":"confirm"===c?(H=l.getStats(),H.uploadFailNum&&(G="已成功上传"+H.successNum+"张照片至XX相册，"+H.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>')):(H=l.getStats(),G="共"+Y+"张（"+D.formatSize(d)+"），已上传"+H.successNum+"张",H.uploadFailNum&&(G+="，失败"+H.uploadFailNum+"张")),p.html(G)}function n(G){var H;if(G!==c){switch(C.removeClass("state-"+c),C.addClass("state-"+G),c=G){case"pedding":f.removeClass("element-invisible"),h.hide(),Z.addClass("element-invisible"),l.refresh();break;case"ready":f.addClass("element-invisible"),E("#filePicker2").removeClass("element-invisible"),h.show(),Z.removeClass("element-invisible"),l.refresh();break;case"uploading":E("#filePicker2").addClass("element-invisible"),a.show(),C.text("暂停上传");break;case"paused":a.show(),C.text("继续上传");break;case"confirm":if(a.hide(),C.text("开始上传").addClass("disabled"),H=l.getStats(),H.successNum&&!H.uploadFailNum){return void n("finish")}break;case"finish":H=l.getStats(),H.successNum?(alert("上传成功"),E(".js-form_photo")[0].submit()):(c="done",location.reload())}o()}}var l,A=E("#uploader"),h=E('<ul class="filelist"></ul>').appendTo(A.find(".queueList")),Z=A.find(".statusBar"),p=Z.find(".info"),C=A.find(".uploadBtn"),f=A.find(".placeholder"),a=Z.find(".progress").hide(),Y=0,d=0,B=window.devicePixelRatio||1,k=110*B,b=110*B,c="pedding",g={},m=function(){var G=document.createElement("p").style,H="transition" in G||"WebkitTransition" in G||"MozTransition" in G||"msTransition" in G||"OTransition" in G;return G=null,H}();l=D.create({pick:{id:"#filePicker",label:"点击选择图片"},dnd:"#dndArea",paste:"#uploader",swf:"../public/complexPlugin/webuploader/dist/Uploader.swf",chunked:!0,sendAsBinary:!0,server:uploadpath,fileNumLimit:300,fileSizeLimit:209715200,fileSingleSizeLimit:52428800}),l.addButton({id:"#filePicker2",label:"继续添加"}),l.onUploadProgress=function(J,G){var H=E("#"+J.id),I=H.find(".progress span");I.css("width",100*G+"%"),g[J.id][1]=G,j()},l.onFileQueued=function(G){Y++,d+=G.size,1===Y&&(f.addClass("element-invisible"),Z.show()),e(G),n("ready"),j()},l.onFileDequeued=function(G){Y--,d-=G.size,Y||n("pedding"),i(G),j()},l.on("all",function(G){switch(G){case"uploadFinished":n("confirm");break;case"startUpload":n("uploading");break;case"stopUpload":n("paused")}}),l.onError=function(G){alert("Eroor: "+G)},C.on("click",function(){return E(this).hasClass("disabled")?!1:void ("ready"===c?l.upload():"paused"===c?l.upload():"uploading"===c&&l.stop())}),p.on("click",".retry",function(){l.retry()}),p.on("click",".ignore",function(){alert("todo")}),C.addClass("state-"+c),j()})});