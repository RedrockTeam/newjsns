require(["jquery","webuploader"],function(a,b){function c(b){var c=a(this);c[0].checked?a(".js-photo_name")[0].disabled=!0:a(".js-photo_name")[0].disabled=!1}console.log(b),a(".js-form_photo .js-check-isAblum").on("click",c),a(function(){function c(b){var c=a('<li id="'+b.id+'"><p class="title">'+b.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),d=a('<div class="file-panel"><span class="cancel">删除</span><span class="rotateRight">向右旋转</span><span class="rotateLeft">向左旋转</span></div>').appendTo(c),e=c.find("p.progress span"),f=c.find("p.imgWrap"),g=a('<p class="error"></p>'),i=function(a){switch(a){case"exceed_size":text="文件大小超出";break;case"interrupt":text="上传暂停";break;default:text="上传失败，请重试"}g.text(text).appendTo(c)};"invalid"===b.getStatus()?i(b.statusText):(f.text("预览中"),h.makeThumb(b,function(b,c){if(b)return void f.text("不能预览");var d=a('<img src="'+c+'">');f.empty().append(d)},s,t),v[b.id]=[b.size,0],b.rotation=0),b.on("statuschange",function(a,f){"progress"===f?e.hide().width(0):"queued"===f&&(c.off("mouseenter mouseleave"),d.remove()),"error"===a||"invalid"===a?(console.log(b.statusText),i(b.statusText),v[b.id][1]=1):"interrupt"===a?i("interrupt"):"queued"===a?v[b.id][1]=0:"progress"===a?(g.remove(),e.css("display","block")):"complete"===a&&c.append('<span class="success"></span>'),c.removeClass("state-"+f).addClass("state-"+a)}),c.on("mouseenter",function(){d.stop().animate({height:30})}),c.on("mouseleave",function(){d.stop().animate({height:0})}),d.on("click","span",function(){var c,d=a(this).index();switch(d){case 0:return void h.removeFile(b);case 1:b.rotation+=90;break;case 2:b.rotation-=90}w?(c="rotate("+b.rotation+"deg)",f.css({"-webkit-transform":c,"-mos-transform":c,"-o-transform":c,transform:c})):f.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(b.rotation/90%4+4)%4+")")}),c.appendTo(j)}function d(b){var c=a("#"+b.id);delete v[b.id],e(),c.off().find(".file-panel").off().end().remove()}function e(){var b,c=0,d=0,e=o.children();a.each(v,function(a,b){d+=b[0],c+=b[0]*b[1]}),b=d?c/d:0,e.eq(0).text(Math.round(100*b)+"%"),e.eq(1).css("width",Math.round(100*b)+"%"),f()}function f(){var a,c="";"ready"===u?c="选中"+p+"张图片，共"+b.formatSize(q)+"。":"confirm"===u?(a=h.getStats(),a.uploadFailNum&&(c="已成功上传"+a.successNum+"张照片至XX相册，"+a.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>')):(a=h.getStats(),c="共"+p+"张（"+b.formatSize(q)+"），已上传"+a.successNum+"张",a.uploadFailNum&&(c+="，失败"+a.uploadFailNum+"张")),l.html(c)}function g(b){var c;if(b!==u){switch(m.removeClass("state-"+u),m.addClass("state-"+b),u=b){case"pedding":n.removeClass("element-invisible"),j.hide(),k.addClass("element-invisible"),h.refresh();break;case"ready":n.addClass("element-invisible"),a("#filePicker2").removeClass("element-invisible"),j.show(),k.removeClass("element-invisible"),h.refresh();break;case"uploading":a("#filePicker2").addClass("element-invisible"),o.show(),m.text("暂停上传");break;case"paused":o.show(),m.text("继续上传");break;case"confirm":if(o.hide(),m.text("开始上传").addClass("disabled"),c=h.getStats(),c.successNum&&!c.uploadFailNum)return void g("finish");break;case"finish":if(c=h.getStats(),c.successNum){alert("上传成功");var d=a(".js-form_photo")[0];if(d.ablum_name.value.length<1)return a(d.ablum_name).css("border-color","red"),alert("请填写标题!!!!"),!1;if(a(d.ablum_name).css("border-color","#ccc"),d.introduce.value.length<1)return a(d.introduce).css("border-color","red"),alert("请填写简介！！！"),!1;a(d.introduce).css("border-color","#ccc"),a(".js-form_photo")[0].submit()}else u="done",location.reload()}f()}}var h,i=a("#uploader"),j=a('<ul class="filelist"></ul>').appendTo(i.find(".queueList")),k=i.find(".statusBar"),l=k.find(".info"),m=i.find(".uploadBtn"),n=i.find(".placeholder"),o=k.find(".progress").hide(),p=0,q=0,r=window.devicePixelRatio||1,s=110*r,t=110*r,u="pedding",v={},w=function(){var a=document.createElement("p").style,b="transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a;return a=null,b}();h=b.create({pick:function(){return{id:"#filePicker",label:"点击选择图片"}}(),dnd:"#dndArea",paste:"#uploader",swf:"../public/complexPlugin/webuploader/dist/Uploader.swf",chunked:!0,sendAsBinary:!0,server:uploadpath,fileNumLimit:300,fileSizeLimit:209715200,fileSingleSizeLimit:52428800}),h.addButton({id:"#filePicker2",label:"继续添加"}),h.onUploadProgress=function(b,c){var d=a("#"+b.id),f=d.find(".progress span");f.css("width",100*c+"%"),v[b.id][1]=c,e()},h.onFileQueued=function(a){p++,q+=a.size,1===p&&(n.addClass("element-invisible"),k.show()),c(a),g("ready"),e()},h.onFileDequeued=function(a){p--,q-=a.size,p||g("pedding"),d(a),e()},h.on("all",function(a){switch(a){case"uploadFinished":g("confirm");break;case"startUpload":g("uploading");break;case"stopUpload":g("paused")}}),h.onError=function(a){alert("Eroor: "+a)},m.on("click",function(){var b=a(".js-form_photo")[0];return b.ablum_name.value.length<1?(a(b.ablum_name).css("border-color","red"),alert("请填写标题!!!!"),!1):(a(b.ablum_name).css("border-color","#ccc"),b.introduce.value.length<1?(a(b.introduce).css("border-color","red"),alert("请填写简介！！！"),!1):(a(b.introduce).css("border-color","#ccc"),a(this).hasClass("disabled")?!1:void("ready"===u?h.upload():"paused"===u?h.upload():"uploading"===u&&h.stop())))}),l.on("click",".retry",function(){h.retry()}),l.on("click",".ignore",function(){alert("todo")}),m.addClass("state-"+u),e()})});