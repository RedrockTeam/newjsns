define(["jquery","underscore","port"],function(a,b,c){function d(b){var c=a(b.target);q=a("body").scrollTop(),l(),r=2,n=c.parents(".js-reply_father"),o=a(".js-reply_item").eq(0).clone(!0),p={to:c.siblings(".js-user_info").find(".js-user_from").attr("data-value"),to_name:c.siblings(".js-user_info").find(".js-user_from").text(),father_id:c.parents(".js-reply_father").attr("data-value")},a(".js-form_editor").find(".js-content").css("text-indent",0).attr("placeholder","回复"+p.to_name+":")}function e(b){var c=a(b.target);q=a("body").scrollTop(),n=c.parents(".js-reply_father"),o=a(".js-reply_item").eq(0).clone(!0),r=1,l(),p={to:c.parents(".js-user_action").siblings(".js-father_user").attr("data-value"),to_name:c.parents(".js-user_action").siblings(".js-father_user").text(),father_id:c.parents(".js-reply_father").attr("data-value")},console.log(c.parents(".js-user_action").siblings(".js-father_user")),a(".js-form_editor").find(".js-content").css("text-indent",0).attr("placeholder","回复"+p.to_name+":")}function f(b){b.preventDefault();var c=a(this);p=a.extend({from:a(".js-user_own_info").attr("data-user_id"),from_name:a(".js-user_own_info").find(".js-user_name").text(),to_name:a(".js-content_title").text(),to:a(".js-content_info").attr("data-value"),type_id:a(".js-passage_info").attr("data-type_id"),passage_id:a(".js-passage_info").attr("data-passage_id"),father_id:0},p),g.call(c)&&h()}function g(){var a=this,b=a.find(".js-content").val();return b.length>300||b.length<1?(alert("您输入的字数不正确!!!"),!1):(p.content=b,!0)}function h(){console.log(p),console.log(c.comment),a.ajax({url:c.comment,method:"POST",dataType:"json",data:p,success:function(a){if("object"!=typeof a)try{a=JSON.parse(a)}catch(b){alert("数据错误!!!!")}a.success?i(a):k(a)},error:function(a){alert("http状态错误"+a.status)}})}function i(){j(),p=null,r=0,a(".js-form_editor").find(".js-content").val("").css("text-indent","2rem").attr("placeholder","这里发表评论(最大字数为300字)"),a("body").scrollTop(q),alert("发表评论成功!!!")}function j(){if(0===r)window.location.reload();else{var c=b.template(a("#temp_reply").html())({data:p});n.find(".js-user_action").before(c)}}function k(a){alert(a.err?a.err:"评论失败")}function l(){a("html, body").css({scrollTop:m.offset().top}).find('input[type="text"]').focus()}var m=a(".js-form_editor"),n=null,o=null,p={},q=0,r=0;a(document.body).on("click",".js-reply_btn",d),a(document.body).on("click",".js-comment_btn",e),m.on("submit",f)});