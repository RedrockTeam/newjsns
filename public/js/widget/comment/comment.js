define(["jquery","underscore","port"],function(Z,j,f){function X(B){var A=Z(B.target);W=Z("body").scrollTop(),S(),e=2,V=A.parents(".js-reply_father"),i=Z(".js-reply_item").eq(0).clone(!0),c={to:A.siblings(".js-user_info").find(".js-user_from").attr("data-value"),to_name:A.siblings(".js-user_info").find(".js-user_from").text(),father_id:A.parents(".js-reply_father").attr("data-value")},Z(".js-form_editor").find(".js-content").css("text-indent",0).attr("placeholder","回复"+c.to_name+":")}function a(B){var A=Z(B.target);W=Z("body").scrollTop(),V=A.parents(".js-reply_father"),i=Z(".js-reply_item").eq(0).clone(!0),e=1,S(),c={to:A.parents(".js-user_action").siblings(".js-father_user").attr("data-value"),to_name:A.parents(".js-user_action").siblings(".js-father_user").text(),father_id:A.parents(".js-reply_father").attr("data-value")},console.log(A.parents(".js-user_action").siblings(".js-father_user")),Z(".js-form_editor").find(".js-content").css("text-indent",0).attr("placeholder","回复"+c.to_name+":")}function b(B){B.preventDefault();var A=Z(this);c=Z.extend({from:Z(".js-user_own_info").attr("data-user_id"),from_name:Z(".js-user_own_info").find(".js-user_name").text(),to_name:Z(".js-content_title").text(),to:Z(".js-content_info").attr("data-value"),type_id:Z(".js-passage_info").attr("data-type_id"),passage_id:Z(".js-passage_info").attr("data-passage_id"),father_id:0},c),d.call(A)&&T()}function d(){var A=this,B=A.find(".js-content").val();return B.length>300||B.length<1?(alert("您输入的字数不正确!!!"),!1):(c.content=B,!0)}function T(){console.log(c),console.log(f.comment),Z.ajax({url:f.comment,method:"POST",dataType:"json",data:c,success:function(A){if("object"!=typeof A){try{A=JSON.parse(A)}catch(B){alert("数据错误!!!!")}}A.success?U(A):h(A)},error:function(A){alert("http状态错误"+A.status)}})}function U(){Y(),c=null,e=0,Z(".js-form_editor").find(".js-content").val("").css("text-indent","2rem").attr("placeholder","这里发表评论(最大字数为300字)"),Z("body").scrollTop(W),alert("发表评论成功!!!")}function Y(){if(0===e){window.location.reload()}else{var A=j.template(Z("#temp_reply").html())({data:c});V.find(".js-user_action").before(A)}}function h(A){alert(A.err?A.err:"评论失败")}function S(){Z("html, body").css({scrollTop:g.offset().top}).find('input[type="text"]').focus()}var g=Z(".js-form_editor"),V=null,i=null,c={},W=0,e=0;Z(document.body).on("click",".js-reply_btn",X),Z(document.body).on("click",".js-comment_btn",a),g.on("submit",b)});