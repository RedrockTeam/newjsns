jQuery.imgAreaSelect={onKeyPress:null};jQuery.imgAreaSelect.init=function(A9,AQ){var H=jQuery("<div></div>"),AV=jQuery("<div></div>"),y=jQuery("<div></div>"),AS=jQuery("<div></div>"),x=jQuery("<div></div>"),AR=jQuery("<div></div>"),Aq=jQuery("<div></div>"),d,Bd,Ad,Bc,A6,AW,Ap,AG,Az,Aa=0,AF,A8,AD,At,AI,AL,Ay=10,A4=[],A5=0,A3=1,Bf,Ar,Be,AC,AM,Av,AN,A2,AZ,Au={x1:0,y1:0,x2:0,y2:0,width:0,height:0};var AT=H.add(AV).add(y);var AJ=AS.add(x).add(AR).add(Aq);function A7(A){return A+Ad.left+AG.left-Ap.left}function Ba(A){return A+Ad.top+AG.top-Ap.top}function Bb(A){return A-Ad.left-AG.left+Ap.left}function AA(A){return A-Ad.top-AG.top+Ap.top}function Ah(A){return A.pageX+AG.left-Ap.left}function Ax(A){return A.pageY+AG.top-Ap.top}function Aw(){Ad=jQuery(A9).offset();Bc=jQuery(A9).width();A6=jQuery(A9).height();if(jQuery(AW).is("body")){Ap=AG={left:0,top:0}}else{Ap=jQuery(AW).offset();AG={left:AW.scrollLeft,top:AW.scrollTop}}d=A7(0);Bd=Ba(0)}function AH(A){AT.css({left:A7(Au.x1)+"px",top:Ba(Au.y1)+"px",width:Math.max(Au.width-AQ.borderWidth*2,0)+"px",height:Math.max(Au.height-AQ.borderWidth*2,0)+"px"});AS.css({left:d+"px",top:Bd+"px",width:Au.x1+"px",height:A6+"px"});x.css({left:d+Au.x1+"px",top:Bd+"px",width:Au.width+"px",height:Au.y1+"px"});AR.css({left:d+Au.x2+"px",top:Bd+"px",width:Bc-Au.x2+"px",height:A6+"px"});Aq.css({left:d+Au.x1+"px",top:Bd+Au.y2+"px",width:Au.width+"px",height:A6-Au.y2+"px"});if(A!==false){if(jQuery.imgAreaSelect.keyPress!=V){jQuery(document).unbind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress)}if(AQ.keys){jQuery(document).bind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress=V)}}}function AP(A){if(!Az){Aw();Az=true;AT.one("mouseout",function(){Az=false})}A2=Bb(Ah(A))-Au.x1;AZ=AA(Ax(A))-Au.y1;A4=[];if(AQ.resizable){if(AZ<=Ay){A4[A5]="n"}else{if(AZ>=Au.height-Ay){A4[A5]="s"}}if(A2<=Ay){A4[A3]="w"}else{if(A2>=Au.width-Ay){A4[A3]="e"}}}y.css("cursor",A4.length?A4.join("")+"-resize":AQ.movable?"move":"")}function As(A){if(A.which!=1){return false}Aw();if(AQ.resizable&&A4.length>0){jQuery("body").css("cursor",A4.join("")+"-resize");AC=A7(A4[A3]=="w"?Au.x2:Au.x1);Av=Ba(A4[A5]=="n"?Au.y2:Au.y1);jQuery(document).mousemove(A1);y.unbind("mousemove",AP);jQuery(document).one("mouseup",function(){A4=[];jQuery("body").css("cursor","");if(AQ.autoHide){AT.add(AJ).hide()}AQ.onSelectEnd(A9,Au);jQuery(document).unbind("mousemove",A1);y.mousemove(AP)})}else{if(AQ.movable){AI=Au.x1+d;AL=Au.y1+Bd;AD=Ah(A);At=Ax(A);jQuery(document).mousemove(AX).one("mouseup",function(){AQ.onSelectEnd(A9,Au);jQuery(document).unbind("mousemove",AX)})}else{jQuery(A9).mousedown(A)}}return false}function AU(){AM=Math.max(d,Math.min(d+Bc,AC+Math.abs(AN-Av)*Be*(AM>=AC?1:-1)));AN=Math.round(Math.max(Bd,Math.min(Bd+A6,Av+Math.abs(AM-AC)/Be*(AN>=Av?1:-1))));AM=Math.round(AM)}function AB(){AN=Math.max(Bd,Math.min(Bd+A6,Av+Math.abs(AM-AC)/Be*(AN>=Av?1:-1)));AM=Math.round(Math.max(d,Math.min(d+Bc,AC+Math.abs(AN-Av)*Be*(AM>=AC?1:-1))));AN=Math.round(AN)}function AE(B,A){AM=B;AN=A;if(AQ.minWidth&&Math.abs(AM-AC)<AQ.minWidth){AM=AC-AQ.minWidth*(AM<AC?1:-1);if(AM<d){AC=d+AQ.minWidth}else{if(AM>d+Bc){AC=d+Bc-AQ.minWidth}}}if(AQ.minHeight&&Math.abs(AN-Av)<AQ.minHeight){AN=Av-AQ.minHeight*(AN<Av?1:-1);if(AN<Bd){Av=Bd+AQ.minHeight}else{if(AN>Bd+A6){Av=Bd+A6-AQ.minHeight}}}AM=Math.max(d,Math.min(AM,d+Bc));AN=Math.max(Bd,Math.min(AN,Bd+A6));if(Be){if(Math.abs(AM-AC)/Be>Math.abs(AN-Av)){AB()}else{AU()}}if(AQ.maxWidth&&Math.abs(AM-AC)>AQ.maxWidth){AM=AC-AQ.maxWidth*(AM<AC?1:-1);if(Be){AB()}}if(AQ.maxHeight&&Math.abs(AN-Av)>AQ.maxHeight){AN=Av-AQ.maxHeight*(AN<Av?1:-1);if(Be){AU()}}Au.x1=Bb(Math.min(AC,AM));Au.x2=Bb(Math.max(AC,AM));Au.y1=AA(Math.min(Av,AN));Au.y2=AA(Math.max(Av,AN));Au.width=Math.abs(AM-AC);Au.height=Math.abs(AN-Av);AH();AQ.onSelectChange(A9,Au)}function A1(A){AM=!A4.length||A4[A3]||Be?Ah(A):A7(Au.x2);AN=!A4.length||A4[A5]||Be?Ax(A):Ba(Au.y2);AE(AM,AN);return false}function AY(A,B){AM=(AC=A)+Au.width;AN=(Av=B)+Au.height;Au.x1=Bb(AC);Au.y1=AA(Av);Au.x2=Bb(AM);Au.y2=AA(AN);AH();AQ.onSelectChange(A9,Au)}function AX(C){var A=Math.max(d,Math.min(AI+Ah(C)-AD,d+Bc-Au.width));var B=Math.max(Bd,Math.min(AL+Ax(C)-At,Bd+A6-Au.height));AY(A,B);C.preventDefault();return false}function AK(A){Aw();Au.x1=Au.x2=Bb(AD=AC=AM=Ah(A));Au.y1=Au.y2=AA(At=Av=AN=Ax(A));Au.width=0;Au.height=0;A4=[];AH();AT.add(AJ).show();jQuery(document).unbind("mouseup",AO).mousemove(A1);y.unbind("mousemove",AP);AQ.onSelectStart(A9,Au);jQuery(document).one("mouseup",function(){if(AQ.autoHide||(Au.width*Au.height==0)){AT.add(AJ).hide()}AQ.onSelectEnd(A9,Au);jQuery(document).unbind("mousemove",A1);y.mousemove(AP)})}function AO(){jQuery(document).unbind("mousemove",AK);AT.add(AJ).hide()}function Bg(A){if(A.which!=1){return false}jQuery(document).one("mousemove",AK).one("mouseup",AO);return false}function A0(){Aw();AH(false);AC=A7(Au.x1);Av=Ba(Au.y1);AM=A7(Au.x2);AN=Ba(Au.y2)}var V=function(D){var A=AQ.keys,C=10,E,B=D.keyCode||D.which;if(!isNaN(A.arrows)){C=A.arrows}if(!isNaN(A.shift)&&D.shiftKey){C=A.shift}if(!isNaN(A.ctrl)&&D.ctrlKey){C=A.ctrl}if(!isNaN(A.alt)&&(D.altKey||D.originalEvent.altKey)){C=A.alt}if(A.arrows=="resize"||(A.shift=="resize"&&D.shiftKey)||(A.ctrl=="resize"&&D.ctrlKey)||(A.alt=="resize"&&(D.altKey||D.originalEvent.altKey))){switch(B){case 37:C=-C;case 39:E=Math.max(AC,AM);AC=Math.min(AC,AM);AM=Math.max(E+C,AC);if(Be){AB()}break;case 38:C=-C;case 40:E=Math.max(Av,AN);Av=Math.min(Av,AN);AN=Math.max(E+C,Av);if(Be){AU()}break;default:return}AE(AM,AN)}else{AC=Math.min(AC,AM);Av=Math.min(Av,AN);switch(B){case 37:AY(Math.max(AC-C,d),Av);break;case 38:AY(AC,Math.max(Av-C,Bd));break;case 39:AY(AC+Math.min(C,Bc-Bb(AM)),Av);break;case 40:AY(AC,Av+Math.min(C,A6-AA(AN)));break;default:return}}return false};this.setOptions=function(A){AQ=jQuery.extend(AQ,A);if(A.x1!=null){Au.x1=A.x1;Au.y1=A.y1;Au.x2=A.x2;Au.y2=A.y2;A.show=true}if(A.keys){AQ.keys=jQuery.extend({shift:1,ctrl:"resize"},A.keys===true?{}:A.keys)}AW=jQuery(AQ.parent).get(0);Aw();A8=jQuery(A9);while(A8.length&&!A8.is("body")){if(!isNaN(A8.css("z-index"))&&A8.css("z-index")>Aa){Aa=A8.css("z-index")}if(A8.css("position")=="fixed"){AF=true}A8=A8.parent()}AC=A7(Au.x1);Av=Ba(Au.y1);AM=A7(Au.x2);AN=Ba(Au.y2);Au.width=AM-AC;Au.height=AN-Av;AH();if(A.hide){AT.add(AJ).hide()}else{if(A.show){AT.add(AJ).show()}}AJ.addClass(AQ.classPrefix+"-outer");H.addClass(AQ.classPrefix+"-selection");AV.addClass(AQ.classPrefix+"-border1");y.addClass(AQ.classPrefix+"-border2");AT.css({borderWidth:AQ.borderWidth+"px"});H.css({backgroundColor:AQ.selectionColor,opacity:AQ.selectionOpacity});AV.css({borderStyle:"solid",borderColor:AQ.borderColor1});y.css({borderStyle:"dashed",borderColor:AQ.borderColor2});AJ.css({opacity:AQ.outerOpacity,backgroundColor:AQ.outerColor});Be=AQ.aspectRatio&&(Ar=AQ.aspectRatio.split(/:/))?Ar[0]/Ar[1]:null;if(AQ.disable||AQ.enable===false){AT.unbind("mousemove",AP).unbind("mousedown",As);jQuery(A9).add(AJ).unbind("mousedown",Bg);jQuery(window).unbind("resize",A0)}else{if(AQ.enable||AQ.disable===false){if(AQ.resizable||AQ.movable){AT.mousemove(AP).mousedown(As)}if(!AQ.persistent){jQuery(A9).add(AJ).mousedown(Bg)}jQuery(window).resize(A0)}}jQuery(AQ.parent).append(AJ.add(AT));AQ.enable=AQ.disable=undefined};if(jQuery.browser.msie){jQuery(A9).attr("unselectable","on")}jQuery.imgAreaSelect.keyPress=jQuery.browser.msie||jQuery.browser.safari?"keydown":"keypress";AT.add(AJ).css({display:"none",position:AF?"fixed":"absolute",overflow:"hidden",zIndex:Aa>0?Aa:"0"});H.css({borderStyle:"solid"});initOptions={borderColor1:"#000",borderColor2:"#fff",borderWidth:1,classPrefix:"imgareaselect",movable:true,resizable:true,selectionColor:"#fff",selectionOpacity:0.2,outerColor:"#000",outerOpacity:0.2,parent:"body",onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}};AQ=jQuery.extend(initOptions,AQ);this.setOptions(AQ)};jQuery.fn.imgAreaSelect=function(B){B=B||{};this.each(function(){if(jQuery(this).data("imgAreaSelect")){jQuery(this).data("imgAreaSelect").setOptions(B)}else{if(B.enable===undefined&&B.disable===undefined){B.enable=true}jQuery(this).data("imgAreaSelect",new jQuery.imgAreaSelect.init(this,B))}});return this};