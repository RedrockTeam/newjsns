jQuery.imgAreaSelect={onKeyPress:null},jQuery.imgAreaSelect.init=function(a,b){function c(a){return a+y.left+D.left-C.left}function d(a){return a+y.top+D.top-C.top}function e(a){return a-y.left-D.left+C.left}function f(a){return a-y.top-D.top+C.top}function g(a){return a.pageX+D.left-C.left}function h(a){return a.pageY+D.top-C.top}function i(){y=jQuery(a).offset(),z=jQuery(a).width(),A=jQuery(a).height(),jQuery(B).is("body")?C=D={left:0,top:0}:(C=jQuery(B).offset(),D={left:B.scrollLeft,top:B.scrollTop}),w=c(0),x=d(0)}function j(a){ea.css({left:c(da.x1)+"px",top:d(da.y1)+"px",width:Math.max(da.width-2*b.borderWidth,0)+"px",height:Math.max(da.height-2*b.borderWidth,0)+"px"}),W.css({left:w+"px",top:x+"px",width:da.x1+"px",height:A+"px"}),X.css({left:w+da.x1+"px",top:x+"px",width:da.width+"px",height:da.y1+"px"}),Y.css({left:w+da.x2+"px",top:x+"px",width:z-da.x2+"px",height:A+"px"}),Z.css({left:w+da.x1+"px",top:x+da.y2+"px",width:da.width+"px",height:A-da.y2+"px"}),a!==!1&&(jQuery.imgAreaSelect.keyPress!=ga&&jQuery(document).unbind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress),b.keys&&jQuery(document).bind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress=ga))}function k(a){E||(i(),E=!0,ea.one("mouseout",function(){E=!1})),R=e(g(a))-da.x1,S=f(h(a))-da.y1,aa=[],b.resizable&&(_>=S?aa[ba]="n":S>=da.height-_&&(aa[ba]="s"),_>=R?aa[ca]="w":R>=da.width-_&&(aa[ca]="e")),V.css("cursor",aa.length?aa.join("")+"-resize":b.movable?"move":"")}function l(e){return 1!=e.which?!1:(i(),b.resizable&&aa.length>0?(jQuery("body").css("cursor",aa.join("")+"-resize"),N=c("w"==aa[ca]?da.x2:da.x1),P=d("n"==aa[ba]?da.y2:da.y1),jQuery(document).mousemove(p),V.unbind("mousemove",k),jQuery(document).one("mouseup",function(){aa=[],jQuery("body").css("cursor",""),b.autoHide&&ea.add(fa).hide(),b.onSelectEnd(a,da),jQuery(document).unbind("mousemove",p),V.mousemove(k)})):b.movable?(J=da.x1+w,K=da.y1+x,H=g(e),I=h(e),jQuery(document).mousemove(r).one("mouseup",function(){b.onSelectEnd(a,da),jQuery(document).unbind("mousemove",r)})):jQuery(a).mousedown(e),!1)}function m(){O=Math.max(w,Math.min(w+z,N+Math.abs(Q-P)*M*(O>=N?1:-1))),Q=Math.round(Math.max(x,Math.min(x+A,P+Math.abs(O-N)/M*(Q>=P?1:-1)))),O=Math.round(O)}function n(){Q=Math.max(x,Math.min(x+A,P+Math.abs(O-N)/M*(Q>=P?1:-1))),O=Math.round(Math.max(w,Math.min(w+z,N+Math.abs(Q-P)*M*(O>=N?1:-1)))),Q=Math.round(Q)}function o(c,d){O=c,Q=d,b.minWidth&&Math.abs(O-N)<b.minWidth&&(O=N-b.minWidth*(N>O?1:-1),w>O?N=w+b.minWidth:O>w+z&&(N=w+z-b.minWidth)),b.minHeight&&Math.abs(Q-P)<b.minHeight&&(Q=P-b.minHeight*(P>Q?1:-1),x>Q?P=x+b.minHeight:Q>x+A&&(P=x+A-b.minHeight)),O=Math.max(w,Math.min(O,w+z)),Q=Math.max(x,Math.min(Q,x+A)),M&&(Math.abs(O-N)/M>Math.abs(Q-P)?n():m()),b.maxWidth&&Math.abs(O-N)>b.maxWidth&&(O=N-b.maxWidth*(N>O?1:-1),M&&n()),b.maxHeight&&Math.abs(Q-P)>b.maxHeight&&(Q=P-b.maxHeight*(P>Q?1:-1),M&&m()),da.x1=e(Math.min(N,O)),da.x2=e(Math.max(N,O)),da.y1=f(Math.min(P,Q)),da.y2=f(Math.max(P,Q)),da.width=Math.abs(O-N),da.height=Math.abs(Q-P),j(),b.onSelectChange(a,da)}function p(a){return O=!aa.length||aa[ca]||M?g(a):c(da.x2),Q=!aa.length||aa[ba]||M?h(a):d(da.y2),o(O,Q),!1}function q(c,d){O=(N=c)+da.width,Q=(P=d)+da.height,da.x1=e(N),da.y1=f(P),da.x2=e(O),da.y2=f(Q),j(),b.onSelectChange(a,da)}function r(a){var b=Math.max(w,Math.min(J+g(a)-H,w+z-da.width)),c=Math.max(x,Math.min(K+h(a)-I,x+A-da.height));return q(b,c),a.preventDefault(),!1}function s(c){i(),da.x1=da.x2=e(H=N=O=g(c)),da.y1=da.y2=f(I=P=Q=h(c)),da.width=0,da.height=0,aa=[],j(),ea.add(fa).show(),jQuery(document).unbind("mouseup",t).mousemove(p),V.unbind("mousemove",k),b.onSelectStart(a,da),jQuery(document).one("mouseup",function(){(b.autoHide||da.width*da.height==0)&&ea.add(fa).hide(),b.onSelectEnd(a,da),jQuery(document).unbind("mousemove",p),V.mousemove(k)})}function t(){jQuery(document).unbind("mousemove",s),ea.add(fa).hide()}function u(a){return 1!=a.which?!1:(jQuery(document).one("mousemove",s).one("mouseup",t),!1)}function v(){i(),j(!1),N=c(da.x1),P=d(da.y1),O=c(da.x2),Q=d(da.y2)}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=jQuery("<div></div>"),U=jQuery("<div></div>"),V=jQuery("<div></div>"),W=jQuery("<div></div>"),X=jQuery("<div></div>"),Y=jQuery("<div></div>"),Z=jQuery("<div></div>"),$=0,_=10,aa=[],ba=0,ca=1,da={x1:0,y1:0,x2:0,y2:0,width:0,height:0},ea=T.add(U).add(V),fa=W.add(X).add(Y).add(Z),ga=function(a){var c,d=b.keys,g=10,h=a.keyCode||a.which;if(isNaN(d.arrows)||(g=d.arrows),!isNaN(d.shift)&&a.shiftKey&&(g=d.shift),!isNaN(d.ctrl)&&a.ctrlKey&&(g=d.ctrl),isNaN(d.alt)||!a.altKey&&!a.originalEvent.altKey||(g=d.alt),"resize"==d.arrows||"resize"==d.shift&&a.shiftKey||"resize"==d.ctrl&&a.ctrlKey||"resize"==d.alt&&(a.altKey||a.originalEvent.altKey)){switch(h){case 37:g=-g;case 39:c=Math.max(N,O),N=Math.min(N,O),O=Math.max(c+g,N),M&&n();break;case 38:g=-g;case 40:c=Math.max(P,Q),P=Math.min(P,Q),Q=Math.max(c+g,P),M&&m();break;default:return}o(O,Q)}else switch(N=Math.min(N,O),P=Math.min(P,Q),h){case 37:q(Math.max(N-g,w),P);break;case 38:q(N,Math.max(P-g,x));break;case 39:q(N+Math.min(g,z-e(O)),P);break;case 40:q(N,P+Math.min(g,A-f(Q)));break;default:return}return!1};this.setOptions=function(e){for(b=jQuery.extend(b,e),null!=e.x1&&(da.x1=e.x1,da.y1=e.y1,da.x2=e.x2,da.y2=e.y2,e.show=!0),e.keys&&(b.keys=jQuery.extend({shift:1,ctrl:"resize"},e.keys===!0?{}:e.keys)),B=jQuery(b.parent).get(0),i(),G=jQuery(a);G.length&&!G.is("body");)!isNaN(G.css("z-index"))&&G.css("z-index")>$&&($=G.css("z-index")),"fixed"==G.css("position")&&(F=!0),G=G.parent();N=c(da.x1),P=d(da.y1),O=c(da.x2),Q=d(da.y2),da.width=O-N,da.height=Q-P,j(),e.hide?ea.add(fa).hide():e.show&&ea.add(fa).show(),fa.addClass(b.classPrefix+"-outer"),T.addClass(b.classPrefix+"-selection"),U.addClass(b.classPrefix+"-border1"),V.addClass(b.classPrefix+"-border2"),ea.css({borderWidth:b.borderWidth+"px"}),T.css({backgroundColor:b.selectionColor,opacity:b.selectionOpacity}),U.css({borderStyle:"solid",borderColor:b.borderColor1}),V.css({borderStyle:"dashed",borderColor:b.borderColor2}),fa.css({opacity:b.outerOpacity,backgroundColor:b.outerColor}),M=b.aspectRatio&&(L=b.aspectRatio.split(/:/))?L[0]/L[1]:null,b.disable||b.enable===!1?(ea.unbind("mousemove",k).unbind("mousedown",l),jQuery(a).add(fa).unbind("mousedown",u),jQuery(window).unbind("resize",v)):(b.enable||b.disable===!1)&&((b.resizable||b.movable)&&ea.mousemove(k).mousedown(l),b.persistent||jQuery(a).add(fa).mousedown(u),jQuery(window).resize(v)),jQuery(b.parent).append(fa.add(ea)),b.enable=b.disable=void 0},jQuery.browser.msie&&jQuery(a).attr("unselectable","on"),jQuery.imgAreaSelect.keyPress=jQuery.browser.msie||jQuery.browser.safari?"keydown":"keypress",ea.add(fa).css({display:"none",position:F?"fixed":"absolute",overflow:"hidden",zIndex:$>0?$:"0"}),T.css({borderStyle:"solid"}),initOptions={borderColor1:"#000",borderColor2:"#fff",borderWidth:1,classPrefix:"imgareaselect",movable:!0,resizable:!0,selectionColor:"#fff",selectionOpacity:.2,outerColor:"#000",outerOpacity:.2,parent:"body",onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},b=jQuery.extend(initOptions,b),this.setOptions(b)},jQuery.fn.imgAreaSelect=function(a){return a=a||{},this.each(function(){jQuery(this).data("imgAreaSelect")?jQuery(this).data("imgAreaSelect").setOptions(a):(void 0===a.enable&&void 0===a.disable&&(a.enable=!0),jQuery(this).data("imgAreaSelect",new jQuery.imgAreaSelect.init(this,a)))}),this};