!function(a,b,c){function d(a,b,c){var d=0,e=0,f=null,h=null;for(done=function(){d===a.length&&(clearInterval(f),c&&c())};e<a.length;e++)h=a[e],h.height=parseInt(h.height),h.width=parseInt(h.width),h.height>=0&&h.width>=0?++d:!function(a){g(a[b],function(b,c){a.width=b,a.height=c,++d},null,function(){a.width=208,a.height=240,a.imgSrc="images/default.jpg",++d})}(h);f=setInterval(done,40)}function e(a,b){clearTimeout(a.tid),b=b||null,a.tid=setTimeout(function(){a.call(b)},100)}function f(a){var b,c,d,e=a.slice(),f=[],g=a.length;for(b=0;g>b;b++)f[b]=b;for(b=0;g>b;b++)for(c=b;g>c;c++)e[c]<e[b]&&(d=e[b],e[b]=e[c],e[c]=d,d=f[b],f[b]=f[c],f[c]=d);return a.minHeight=a[f[0]],a.maxHeight=a[f[f.length-1]],f}a.fn.waterfall=function(g){function h(){u||t||v.minHeight+y<a(b).height()+a(b).scrollTop()&&(x.length>0?i():"infinite"===q.ajaxTimes||s<q.ajaxTimes?(k("loading"),q.params.ajax=++s,B(function(b){try{"string"==typeof b&&(b=a.parseJSON(b)),a.isEmptyObject(b)||"string"==typeof b?k("finish"):(x=x.concat(b.data).reverse(),i())}catch(c){k("error")}},function(){k("error")})):k("finish"))}function i(){var b,c,e,g="number"==typeof q.perNum?q.perNum:q.colNum,i=null;m.height(),d(x,q.imgUrlName,function(){for(;g-->0&&(i=x.pop());)w=f(v)[0],A=w*(q.colWidth+q.marginLeft),z=v[w]+q.marginTop,e=C(i),b=a("<div>").addClass(q.itemClass).html(e).css({left:A,top:z}).appendTo(m),c=b.find("."+q.imgClass),c.width("200px"),c.height(c.width()*(i.height/i.width)),q.isAnimation&&b.css({opacity:0}).animate({opacity:1},800),v[w]=z+b.outerHeight(),v[w]>v.maxHeight&&(v.maxHeight=v[w]),m.height(v.maxHeight);t=!1,o.hide(),h()})}function j(){var b=0,c=0,d=0,e=0;if(b=Math.floor((l.width()+q.marginLeft)/(q.colWidth+q.marginLeft)),b>0&&b!==q.colNum){for(q.colNum=b,m.width((q.colWidth+q.marginLeft)*q.colNum-q.marginLeft),c=0;c<q.colNum;c++)v[c]=0;v.length=q.colNum,n=m.children(".wf_item"),n.each(function(){w=f(v)[0],z=v[w]+q.marginTop,A=w*(q.colWidth+q.marginLeft),q.isAnimation&&(e=300),a(this).width(q.colWidth).animate({left:A,top:z},e),v[w]=z+a(this).outerHeight()}),f(v),m.height(v.maxHeight),h()}d=m.offset().left+(m.width()+l.width())/2-p.width(),D(p[0],{left:d,bottom:0})}function k(a){switch(a){case"loading":t=!0,o.html("").addClass("wf_loading").show();break;case"error":o.removeClass("wf_loading").show().html("数据格式错误，请返回标准的Json数据或Json格式字符串！"),u=!0;break;case"finish":o.removeClass("wf_loading").show().html("已加载完毕，没有更多了！"),u=!0}}var l,m,n,o,p,q=a.extend({},a.fn.waterfall.defaults,g),r=!-[1]&&!b.XMLHttpRequest,s=0,t=!1,u=!1,v=[],w=0,x=[],y=0,z=0,A=0,B=a.isFunction(q.ajaxFunc)?q.ajaxFunc:function(b,c){a.ajax({type:"GET",url:q.url,cache:!1,data:q.params,dataType:"json",timeout:6e4,success:b,error:c})},C=a.isFunction(q.createHtml)?q.createHtml:function(a){return'<div class="wf_item_inner"><a href="'+a.href+'" class="thumb" target="_blank"><img class="'+q.imgClass+'"  src="'+a.imgSrc+'" /></a><h3 class="title"><a href="'+a.href+'" target="_blank">'+a.title+'</a></h3><p class="desc">'+a.describe+"</p></div>"},D=function(){var a=c.getElementsByTagName("html")[0],b=c.documentElement,d=c.body,e=b||d;return r&&"fixed"!==d.currentStyle.backgroundAttachment&&(a.style.backgroundImage="url(about:blank)",a.style.backgroundAttachment="fixed"),r?function(a,b){var c=a.style,d="(document.documentElement || document.body)";"number"!=typeof b.left&&(b.left=e.clientWidth-b.right-a.offsetWidth),"number"!=typeof b.top&&(b.top=e.clientHeight-b.bottom-a.offsetHeight),a.style.position="absolute",c.removeExpression("left"),c.removeExpression("top"),c.setExpression("left","eval("+d+".scrollLeft + "+b.left+') + "px"'),c.setExpression("top","eval("+d+".scrollTop + "+b.top+') + "px"')}:function(a,b){var c=a.style;c.position="fixed","number"==typeof b.left?c.left=b.left+"px":(c.left="auto",c.right=b.right+"px"),"number"==typeof b.top?c.top=b.top+"px":(c.top="auto",c.bottom=b.bottom+"px")}}();return this.each(function(){return a(this).data("_wf_is_done_")?!0:(l=a(this).addClass("waterfall").data("_wf_is_done_",!0),y=l.offset().top,m=l.children(".wf_col"),0===m.length&&(m=a("<div>").addClass("wf_col").appendTo(l)),o=a("<div>").addClass("wf_result").appendTo(l),p=a("<a></a>").attr("id","backTop").attr("title","返回顶部").appendTo(c.body),p.css("opacity",0).bind("click",function(){a("body,html").stop(!0).animate({scrollTop:y},500)}),a(c.body).css("overflow","scroll"),j(),a(c.body).css("overflow","auto"),h(),void a(b).bind("scroll",function(){a(b).scrollTop()>y?p.stop(!0).animate({opacity:1},500):p.stop(!0).animate({opacity:0},500),h()}).bind("resize",function(){e(j)}))})},a.fn.waterfall.defaults={itemClass:"wf_item",imgClass:"thumb_img",colWidth:235,marginLeft:15,marginTop:15,perNum:"auto",isAnimation:!0,ajaxTimes:"infinite",imgUrlName:"img_src",params:{},url:"",ajaxFunc:null,createHtml:null};var g=function(){var a=[],b=null,c=function(){for(var b=0;b<a.length;b++)a[b].end?a.splice(b--,1):a[b]();!a.length&&d()},d=function(){clearInterval(b),b=null};return function(d,e,f,g){var h,i,j,k,l,m=new Image;return d?(m.src=d,m.complete?(e(m.width,m.height),void(f&&f(m.width,m.height))):(i=m.width,j=m.height,h=function(){k=m.width,l=m.height,(k!==i||l!==j||k*l>1024)&&(e(k,l),h.end=!0)},h(),m.onerror=function(){alert("图片加载错误"),g&&g(),h.end=!0,m=m.onload=m.onerror=null},m.onload=function(){f&&f(m.width,m.height),!h.end&&h(),m=m.onload=m.onerror=null},void(h.end||(a.push(h),null===b&&(b=setInterval(c,40)))))):void(g&&g())}}()}(jQuery,window,document);