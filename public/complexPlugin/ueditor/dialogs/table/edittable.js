(function(){var G=$G("J_title"),F=$G("J_titleCol"),C=$G("J_caption"),J=$G("J_sorttable"),E=$G("J_autoSizeContent"),D=$G("J_autoSizePage"),B=$G("J_tone"),A,H=$G("J_preview");var I=function(){A=this;A.init()};I.prototype={init:function(){var N=new UE.ui.ColorPicker({editor:editor}),K=new UE.ui.Popup({editor:editor,content:N});G.checked=editor.queryCommandState("inserttitle")==-1;F.checked=editor.queryCommandState("inserttitlecol")==-1;C.checked=editor.queryCommandState("insertcaption")==-1;J.checked=editor.queryCommandState("enablesort")==1;var M=editor.queryCommandState("enablesort"),L=editor.queryCommandState("disablesort");J.checked=!!(M<0&&L>=0);J.disabled=!!(M<0&&L<0);J.title=M<0&&L<0?lang.errorMsg:"";A.createTable(G.checked,F.checked,C.checked);A.setAutoSize();A.setColor(A.getColor());domUtils.on(G,"click",A.titleHanler);domUtils.on(F,"click",A.titleColHanler);domUtils.on(C,"click",A.captionHanler);domUtils.on(J,"click",A.sorttableHanler);domUtils.on(E,"click",A.autoSizeContentHanler);domUtils.on(D,"click",A.autoSizePageHanler);domUtils.on(B,"click",function(){K.showAnchor(B)});domUtils.on(document,"mousedown",function(){K.hide()});N.addListener("pickcolor",function(){A.setColor(arguments[1]);K.hide()});N.addListener("picknocolor",function(){A.setColor("");K.hide()})},createTable:function(M,K,R){var P=[],Q="<span>^</span>";P.push("<table id='J_example'>");if(R){P.push("<caption>"+lang.captionName+"</caption>")}if(M){P.push("<tr>");if(K){P.push("<th>"+lang.titleName+"</th>")}for(var L=0;L<5;L++){P.push("<th>"+lang.titleName+"</th>")}P.push("</tr>")}for(var N=0;N<6;N++){P.push("<tr>");if(K){P.push("<th>"+lang.titleName+"</th>")}for(var O=0;O<5;O++){P.push("<td>"+lang.cellsName+"</td>")}P.push("</tr>")}P.push("</table>");H.innerHTML=P.join("");this.updateSortSpan()},titleHanler:function(){var O=$G("J_example"),N=document.createDocumentFragment(),P=domUtils.getComputedStyle(domUtils.getElementsByTagName(O,"td")[0],"border-color"),K=O.rows[0].children.length;if(G.checked){O.insertRow(0);for(var L=0,M;L<K;L++){M=document.createElement("th");M.innerHTML=lang.titleName;N.appendChild(M)}O.rows[0].appendChild(N)}else{domUtils.remove(O.rows[0])}A.setColor(P);A.updateSortSpan()},titleColHanler:function(){var O=$G("J_example"),P=domUtils.getComputedStyle(domUtils.getElementsByTagName(O,"td")[0],"border-color"),N=O.rows,K=N.length;if(F.checked){for(var L=0,M;L<K;L++){M=document.createElement("th");M.innerHTML=lang.titleName;N[L].insertBefore(M,N[L].children[0])}}else{for(var L=0;L<K;L++){domUtils.remove(N[L].children[0])}}A.setColor(P);A.updateSortSpan()},captionHanler:function(){var L=$G("J_example");if(C.checked){var K=document.createElement("caption");K.innerHTML=lang.captionName;L.insertBefore(K,L.firstChild)}else{domUtils.remove(domUtils.getElementsByTagName(L,"caption")[0])}},sorttableHanler:function(){A.updateSortSpan()},autoSizeContentHanler:function(){var K=$G("J_example");K.removeAttribute("width")},autoSizePageHanler:function(){var K=$G("J_example");var L=K.getElementsByTagName(K,"td");utils.each(L,function(M){M.removeAttribute("width")});K.setAttribute("width","100%")},updateSortSpan:function(){var L=$G("J_example"),K=L.rows[0];var M=domUtils.getElementsByTagName(L,"span");utils.each(M,function(N){N.parentNode.removeChild(N)});if(J.checked){utils.each(K.cells,function(P,N){var O=document.createElement("span");O.innerHTML="^";P.appendChild(O)})}},getColor:function(){var M=editor.selection.getStart(),K,L=domUtils.findParentByTagName(M,["td","th","caption"],true);K=L&&domUtils.getComputedStyle(L,"border-color");if(!K){K="#DDDDDD"}return K},setColor:function(M){var K=$G("J_example"),L=domUtils.getElementsByTagName(K,"td").concat(domUtils.getElementsByTagName(K,"th"),domUtils.getElementsByTagName(K,"caption"));B.value=M;utils.each(L,function(N){N.style.borderColor=M})},setAutoSize:function(){var K=this;D.checked=true;K.autoSizePageHanler()}};new I;dialog.onok=function(){editor.__hasEnterExecCommand=true;var M={title:"inserttitle deletetitle",titleCol:"inserttitlecol deletetitlecol",caption:"insertcaption deletecaption",sorttable:"enablesort disablesort"};editor.fireEvent("saveScene");for(var K in M){var N=M[K].split(" "),L=$G("J_"+K);if(L["checked"]){editor.queryCommandState(N[0])!=-1&&editor.execCommand(N[0])}else{editor.queryCommandState(N[1])!=-1&&editor.execCommand(N[1])}}editor.execCommand("edittable",B.value);E.checked?editor.execCommand("adaptbytext"):"";D.checked?editor.execCommand("adaptbywindow"):"";editor.fireEvent("saveScene");editor.__hasEnterExecCommand=false}})();