(function(B){var G=B.getOptions().plotOptions,E=B.seriesTypes,C=B.merge,F=function(){},H=B.each;G.funnel=C(G.pie,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",dataLabels:{connectorWidth:1,connectorColor:"#606060"},size:!0,states:{select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}}});E.funnel=B.extendClass(E.pie,{type:"funnel",animate:F,translate:function(){var X=function(c,b){return/%$/.test(c)?b*parseInt(c,10)/100:parseInt(c,10)},Z=0,z=this.chart,Y=z.plotWidth,z=z.plotHeight,P=0,W=this.options,Ab=W.center,V=X(Ab[0],Y),k=X(Ab[0],z),I=X(W.width,Y),Q,J,O=X(W.height,z),A=X(W.neckWidth,Y),D=X(W.neckHeight,z),K=O-D,X=this.data,L,Ac,N=W.dataLabels.position==="left"?1:0,Ad,U,Aa,R,T,M,S;this.getWidthAt=J=function(a){return a>O-D||O===D?A:A+(I-A)*((O-D-a)/(O-D))};this.getX=function(c,b){return V+(b?-1:1)*(J(c)/2+W.dataLabels.distance)};this.center=[V,k,O];this.centerX=V;H(X,function(b){Z+=b.y});H(X,function(b){S=null;Ac=Z?b.y/Z:0;U=k-O/2+P*O;T=U+Ac*O;Q=J(U);Ad=V-Q/2;Aa=Ad+Q;Q=J(T);R=V-Q/2;M=R+Q;U>K?(Ad=R=V-A/2,Aa=M=V+A/2):T>K&&(S=T,Q=J(K),R=V-Q/2,M=R+Q,T=K);L=["M",Ad,U,"L",Aa,U,M,T];S&&L.push(M,S,R,S);L.push(R,T,"Z");b.shapeType="path";b.shapeArgs={d:L};b.percentage=Ac*100;b.plotX=V;b.plotY=(U+(S||T))/2;b.tooltipPos=[V,b.plotY];b.slice=F;b.half=N;P+=Ac});this.setTooltipPoints()},drawPoints:function(){var I=this,A=I.options,D=I.chart.renderer;H(I.data,function(L){var J=L.graphic,K=L.shapeArgs;J?J.animate(K):L.graphic=D.path(K).attr({fill:L.color,stroke:A.borderColor,"stroke-width":A.borderWidth}).add(I.group)})},sortByAngle:F,drawDataLabels:function(){var K=this.data,M=this.options.dataLabels.distance,A,L,D,J=K.length,N,I;for(this.center[2]-=2*M;J--;){D=K[J],L=(A=D.half)?1:-1,I=D.plotY,N=this.getX(I,A),D.labelPos=[0,I,N+(M-5)*L,I,N+M*L,I,A?"right":"left",0]}E.pie.prototype.drawDataLabels.call(this)}})})(Highcharts);