(function(C){var A=C.each;var B=function(D,E){this.init(D,E)};C.extend(B.prototype,{init:function(D,E){this.options=D;this.chartOptions=E;this.columns=D.columns||this.rowsToColumns(D.rows)||[];if(this.columns.length){this.dataFound()}else{this.parseCSV();this.parseTable();this.parseGoogleSpreadsheet()}},getColumnDistribution:function(){var E=this.chartOptions,F=function(H){return(C.seriesTypes[H||"line"].prototype.pointArrayMap||[0]).length},D=E&&E.chart&&E.chart.type,G=[];A((E&&E.series)||[],function(H){G.push(F(H.type||D))});this.valueCount={global:F(D),individual:G}},dataFound:function(){this.parseTypes();this.findHeaderRow();this.parsed();this.complete()},parseCSV:function(){var K=this,I=this.options,H=I.csv,E=this.columns,J=I.startRow||0,F=I.endRow||Number.MAX_VALUE,G=I.startColumn||0,D=I.endColumn||Number.MAX_VALUE,M,L=0;if(H){M=H.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(I.lineDelimiter||"\n");A(M,function(R,P){var N=K.trim(R),O=N.indexOf("#")===0,S=N==="",Q;if(P>=J&&P<=F&&!O&&!S){Q=R.split(I.itemDelimiter||",");A(Q,function(U,T){if(T>=G&&T<=D){if(!E[T-G]){E[T-G]=[]}E[T-G][L]=U}});L+=1}});this.dataFound()}},parseTable:function(){var I=this.options,K=I.table,F=this.columns,J=I.startRow||0,G=I.endRow||Number.MAX_VALUE,H=I.startColumn||0,D=I.endColumn||Number.MAX_VALUE,E;if(K){if(typeof K==="string"){K=document.getElementById(K)}A(K.getElementsByTagName("tr"),function(M,L){E=0;if(L>=J&&L<=G){A(M.childNodes,function(N){if((N.tagName==="TD"||N.tagName==="TH")&&E>=H&&E<=D){if(!F[E]){F[E]=[]}F[E][L-J]=N.innerHTML;E+=1}})}});this.dataFound()}},parseGoogleSpreadsheet:function(){var K=this,I=this.options,G=I.googleSpreadsheetKey,F=this.columns,J=I.startRow||0,L=I.endRow||Number.MAX_VALUE,H=I.startColumn||0,D=I.endColumn||Number.MAX_VALUE,M,E;if(G){jQuery.getJSON("https://spreadsheets.google.com/feeds/cells/"+G+"/"+(I.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",function(R){var S=R.feed.entry,T,P=S.length,N=0,O=0,Q;for(Q=0;Q<P;Q++){T=S[Q];N=Math.max(N,T.gs$cell.col);O=Math.max(O,T.gs$cell.row)}for(Q=0;Q<N;Q++){if(Q>=H&&Q<=D){F[Q-H]=[];F[Q-H].length=Math.min(O,L-J)}}for(Q=0;Q<P;Q++){T=S[Q];M=T.gs$cell.row-1;E=T.gs$cell.col-1;if(E>=H&&E<=D&&M>=J&&M<=L){F[E-H][M-J]=T.content.$t}}K.dataFound()})}},findHeaderRow:function(){var D=0;A(this.columns,function(E){if(typeof E[0]!=="string"){D=null}});this.headerRow=0},trim:function(D){return typeof D==="string"?D.replace(/^\s+|\s+$/g,""):D},parseTypes:function(){var J=this.columns,D=J.length,G,I,F,H,E;while(D--){G=J[D].length;while(G--){I=J[D][G];F=parseFloat(I);H=this.trim(I);if(H==F){J[D][G]=F;if(F>365*24*3600*1000){J[D].isDatetime=true}else{J[D].isNumeric=true}}else{E=this.parseDate(I);if(D===0&&typeof E==="number"&&!isNaN(E)){J[D][G]=E;J[D].isDatetime=true}else{J[D][G]=H===""?null:H}}}}},dateFormats:{"YYYY-mm-dd":{regex:"^([0-9]{4})-([0-9]{2})-([0-9]{2})$",parser:function(D){return Date.UTC(+D[1],D[2]-1,+D[3])}}},parseDate:function(I){var G=this.options.parseDate,H,D,E,F;if(G){H=G(I)}if(typeof I==="string"){for(D in this.dateFormats){E=this.dateFormats[D];F=I.match(E.regex);if(F){H=E.parser(F)}}}return H},rowsToColumns:function(G){var F,D,E,H,I;if(G){I=[];D=G.length;for(F=0;F<D;F++){H=G[F].length;for(E=0;E<H;E++){if(!I[E]){I[E]=[]}I[E][F]=G[F][E]}}}return I},parsed:function(){if(this.options.parsed){this.options.parsed.call(this,this.columns)}},complete:function(){var E=this.columns,L,K,H=this.options,I,J,D,G,F,M;if(H.complete){this.getColumnDistribution();if(E.length>1){L=E.shift();if(this.headerRow===0){L.shift()}if(L.isDatetime){K="datetime"}else{if(!L.isNumeric){K="category"}}}for(G=0;G<E.length;G++){if(this.headerRow===0){E[G].name=E[G].shift()}}J=[];for(G=0,M=0;G<E.length;M++){I=C.pick(this.valueCount.individual[M],this.valueCount.global);D=[];for(F=0;F<E[G].length;F++){D[F]=[L[F],E[G][F]!==undefined?E[G][F]:null];if(I>1){D[F].push(E[G+1][F]!==undefined?E[G+1][F]:null)}if(I>2){D[F].push(E[G+2][F]!==undefined?E[G+2][F]:null)}if(I>3){D[F].push(E[G+3][F]!==undefined?E[G+3][F]:null)}if(I>4){D[F].push(E[G+4][F]!==undefined?E[G+4][F]:null)}}J[M]={name:E[G].name,data:D};G+=I}H.complete({xAxis:{type:K},series:J})}}});C.Data=B;C.data=function(D,E){return new B(D,E)};C.wrap(C.Chart.prototype,"init",function(E,G,D){var F=this;if(G&&G.data){C.data(C.extend(G.data,{complete:function(H){if(G.series){A(G.series,function(J,I){G.series[I]=C.merge(J,H.series[I])})}G=C.merge(H,G);E.call(F,G,D)}}),G)}else{E.call(F,G,D)}})}(Highcharts));