/* WebUploader 0.1.2 */
(function(H,D){var G={},E=function(M,K){var O,N,L;if(typeof M==="string"){return I(M)}else{O=[];for(N=M.length,L=0;L<N;L++){O.push(I(M[L]))}return K.apply(null,O)}},A=function(M,L,K){if(arguments.length===2){K=L;L=null}E(L||[],function(){C(M,K,arguments)})},C=function(O,K,N){var M={exports:K},L;if(typeof K==="function"){N.length||(N=[E,M.exports,M]);L=K.apply(null,N);L!==undefined&&(M.exports=L)}G[O]=M.exports},I=function(L){var K=G[L]||H[L];if(!K){throw new Error("`"+L+"` is undefined")}return K},B=function(M){var L,N,K,O,P,Q;Q=function(R){return R&&(R.charAt(0).toUpperCase()+R.substr(1))};for(L in G){N=M;if(!G.hasOwnProperty(L)){continue}K=L.split("/");P=Q(K.pop());while((O=Q(K.shift()))){N[O]=N[O]||{};N=N[O]}N[P]=G[L]}},J=D(H,A,E),F;B(J);if(typeof module==="object"&&typeof module.exports==="object"){module.exports=J}else{if(typeof define==="function"&&define.amd){define([],J)}else{F=H.WebUploader;H.WebUploader=J;H.WebUploader.noConflict=function(){H.WebUploader=F}}}})(this,function(A,C,B){C("dollar-third",[],function(){return A.jQuery||A.Zepto});C("dollar",["dollar-third"],function(D){return D});C("promise-third",["dollar"],function(D){return{Deferred:D.Deferred,when:D.when,isPromise:function(E){return E&&typeof E.then==="function"}}});C("promise",["promise-third"],function(D){return D});C("base",["dollar","promise"],function(J,H){var I=function(){},E=Function.call;function D(K){return function(){return E.apply(K,arguments)}}function G(L,K){return function(){return L.apply(K,arguments)}}function F(K){var L;if(Object.create){return Object.create(K)}else{L=function(){};L.prototype=K;return new L()}}return{version:"0.1.2",$:J,Deferred:H.Deferred,isPromise:H.isPromise,when:H.when,browser:(function(O){var P={},R=O.match(/WebKit\/([\d.]+)/),L=O.match(/Chrome\/([\d.]+)/)||O.match(/CriOS\/([\d.]+)/),M=O.match(/MSIE\s([\d\.]+)/)||O.match(/(?:trident)(?:.*rv:([\w.]+))?/i),N=O.match(/Firefox\/([\d.]+)/),K=O.match(/Safari\/([\d.]+)/),Q=O.match(/OPR\/([\d.]+)/);R&&(P.webkit=parseFloat(R[1]));L&&(P.chrome=parseFloat(L[1]));M&&(P.ie=parseFloat(M[1]));N&&(P.firefox=parseFloat(N[1]));K&&(P.safari=parseFloat(K[1]));Q&&(P.opera=parseFloat(Q[1]));return P})(navigator.userAgent),os:(function(N){var L={},M=N.match(/(?:Android);?[\s\/]+([\d.]+)?/),K=N.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);M&&(L.android=parseFloat(M[1]));K&&(L.ios=parseFloat(K[1].replace(/_/g,".")));return L})(navigator.userAgent),inherits:function(N,M,L){var K;if(typeof M==="function"){K=M;M=null}else{if(M&&M.hasOwnProperty("constructor")){K=M.constructor}else{K=function(){return N.apply(this,arguments)}}}J.extend(true,K,N,L||{});K.__super__=N.prototype;K.prototype=F(N.prototype);M&&J.extend(true,K.prototype,M);return K},noop:I,bindFn:G,log:(function(){if(A.console){return G(console.log,console)}return I})(),nextTick:(function(){return function(K){setTimeout(K,1)}})(),slice:D([].slice),guid:(function(){var K=0;return function(N){var L=(+new Date()).toString(32),M=0;for(;M<5;M++){L+=Math.floor(Math.random()*65535).toString(32)}return(N||"wu_")+L+(K++).toString(32)}})(),formatSize:function(K,M,N){var L;N=N||["B","K","M","G","TB"];while((L=N.shift())&&K>1024){K=K/1024}return(L==="B"?K:K.toFixed(M||2))+L}}});C("mediator",["base"],function(K){var J=K.$,D=[].slice,G=/\s+/,I;function F(O,N,L,M){return J.grep(O,function(P){return P&&(!N||P.e===N)&&(!L||P.cb===L||P.cb._cb===L)&&(!M||P.ctx===M)})}function H(N,L,M){J.each((N||"").split(G),function(P,O){M(O,L)})}function E(P,Q){var M=false,L=-1,O=P.length,N;while(++L<O){N=P[L];if(N.cb.apply(N.ctx2,Q)===false){M=true;break}}return !M}I={on:function(N,L,M){var O=this,P;if(!L){return this}P=this._events||(this._events=[]);H(N,L,function(S,Q){var R={e:S};R.cb=Q;R.ctx=M;R.ctx2=M||O;R.id=P.length;P.push(R)});return this},once:function(N,L,M){var O=this;if(!L){return O}H(N,L,function(Q,P){var R=function(){O.off(Q,R);return P.apply(M||O,arguments)};R._cb=P;O.on(Q,R,M)});return O},off:function(M,L,O){var N=this._events;if(!N){return this}if(!M&&!L&&!O){this._events=[];return this}H(M,L,function(Q,P){J.each(F(N,Q,P,O),function(){delete N[this.id]})});return this},trigger:function(L){var O,N,M;if(!this._events||!L){return this}O=D.call(arguments,1);N=F(this._events,L);M=F(this._events,"all");return E(N,O)&&E(M,arguments)}};return J.extend({installTo:function(L){return J.extend(L,I)}},I)});C("uploader",["base","mediator"],function(E,F){var G=E.$;function D(H){this.options=G.extend(true,{},D.options,H);this._init(this.options)}D.options={};F.installTo(D.prototype);G.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(H,I){D.prototype[H]=function(){return this.request(I,arguments)}});G.extend(D.prototype,{state:"pending",_init:function(H){var I=this;I.request("init",H,function(){I.state="ready";I.trigger("ready")})},option:function(H,J){var I=this.options;if(arguments.length>1){if(G.isPlainObject(J)&&G.isPlainObject(I[H])){G.extend(I[H],J)}else{I[H]=J}}else{return H?I[H]:I}},getStats:function(){var H=this.request("get-stats");return{successNum:H.numOfSuccess,cancelNum:H.numOfCancel,invalidNum:H.numOfInvalid,uploadFailNum:H.numOfUploadFailed,queueNum:H.numOfQueue}},trigger:function(H){var K=[].slice.call(arguments,1),I=this.options,J="on"+H.substring(0,1).toUpperCase()+H.substring(1);if(F.trigger.apply(this,arguments)===false||G.isFunction(I[J])&&I[J].apply(this,K)===false||G.isFunction(this[J])&&this[J].apply(this,K)===false||F.trigger.apply(F,[this,H].concat(K))===false){return false}return true},request:E.noop});E.create=D.create=function(H){return new D(H)};E.Uploader=D;return D});C("runtime/runtime",["base","mediator"],function(G,H){var I=G.$,F={},E=function(K){for(var J in K){if(K.hasOwnProperty(J)){return J}}return null};function D(J){this.options=I.extend({container:document.body},J);this.uid=G.guid("rt_")}I.extend(D.prototype,{getContainer:function(){var J=this.options,L,K;if(this._container){return this._container}L=I(J.container||document.body);K=I(document.createElement("div"));K.attr("id","rt_"+this.uid);K.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});L.append(K);L.addClass("webuploader-container");this._container=K;return K},init:G.noop,exec:G.noop,destroy:function(){if(this._container){this._container.parentNode.removeChild(this.__container)}this.off()}});D.orders="html5,flash";D.addRuntime=function(J,K){F[J]=K};D.hasRuntime=function(J){return !!(J?F[J]:E(F))};D.create=function(K,M){var J,L;M=M||D.orders;I.each(M.split(/\s*,\s*/g),function(){if(F[this]){J=this;return false}});J=J||E(F);if(!J){throw new Error("Runtime Error")}L=new F[J](K);return L};H.installTo(D.prototype);return D});C("runtime/client",["base","mediator","runtime/runtime"],function(G,H,E){var D;D=(function(){var I={};return{add:function(J){I[J.uid]=J},get:function(J,L){var K;if(J){return I[J]}for(K in I){if(L&&I[K].__standalone){continue}return I[K]}return null},remove:function(J){delete I[J.uid]}}})();function F(J,I){var K=G.Deferred(),L;this.uid=G.guid("client_");this.runtimeReady=function(M){return K.done(M)};this.connectRuntime=function(N,M){if(L){throw new Error("already connected!")}K.done(M);if(typeof N==="string"&&D.get(N)){L=D.get(N)}L=L||D.get(null,I);if(!L){L=E.create(N,N.runtimeOrder);L.__promise=K.promise();L.once("ready",K.resolve);L.init();D.add(L);L.__client=1}else{G.$.extend(L.options,N);L.__promise.then(K.resolve);L.__client++}I&&(L.__standalone=I);return L};this.getRuntime=function(){return L};this.disconnectRuntime=function(){if(!L){return}L.__client--;if(L.__client<=0){D.remove(L);delete L.__promise;L.destroy()}L=null};this.exec=function(){if(!L){return}var M=G.slice(arguments);J&&M.unshift(J);return L.exec.apply(this,M)};this.getRuid=function(){return L&&L.uid};this.destroy=(function(M){return function(){M&&M.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}H.installTo(F.prototype);return F});C("lib/dnd",["base","mediator","runtime/client"],function(F,G,E){var H=F.$;function D(I){I=this.options=H.extend({},D.options,I);I.container=H(I.container);if(!I.container.length){return}E.call(this,"DragAndDrop")}D.options={accept:null,disableGlobalDnd:false};F.inherits(E,{constructor:D,init:function(){var I=this;I.connectRuntime(I.options,function(){I.exec("init");I.trigger("ready")})},destroy:function(){this.disconnectRuntime()}});G.installTo(D.prototype);return D});C("widgets/widget",["base","uploader"],function(K,E){var J=K.$,F=E.prototype._init,H={},G=[];function D(N){if(!N){return false}var M=N.length,L=J.type(N);if(N.nodeType===1&&M){return true}return L==="array"||L!=="function"&&L!=="string"&&(M===0||typeof M==="number"&&M>0&&(M-1) in N)}function I(L){this.owner=L;this.options=L.options}J.extend(I.prototype,{init:K.noop,invoke:function(M,N){var L=this.responseMap;if(!L||!(M in L)||!(L[M] in this)||!J.isFunction(this[L[M]])){return H}return this[L[M]].apply(this,N)},request:function(){return this.owner.request.apply(this.owner,arguments)}});J.extend(E.prototype,{_init:function(){var L=this,M=L._widgets=[];J.each(G,function(O,N){M.push(new N(L))});return F.apply(L,arguments)},request:function(W,M,N){var Q=0,U=this._widgets,L=U.length,V=[],P=[],S,O,T,R;M=D(M)?M:[M];for(;Q<L;Q++){S=U[Q];O=S.invoke(W,M);if(O!==H){if(K.isPromise(O)){P.push(O)}else{V.push(O)}}}if(N||P.length){T=K.when.apply(K,P);R=T.pipe?"pipe":"then";return T[R](function(){var X=K.Deferred(),Y=arguments;setTimeout(function(){X.resolve.apply(X,Y)},1);return X.promise()})[R](N||K.noop)}else{return V[0]}}});E.register=I.register=function(O,L){var M={init:"init"},N;if(arguments.length===1){L=O;L.responseMap=M}else{L.responseMap=J.extend(M,O)}N=K.inherits(I,L);G.push(N);return N};return I});C("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(F,E,D){var G=F.$;E.options.dnd="";return E.register({init:function(I){if(!I.dnd||this.request("predict-runtime-type")!=="html5"){return}var K=this,L=F.Deferred(),J=G.extend({},{disableGlobalDnd:I.disableGlobalDnd,container:I.dnd,accept:I.accept}),H;H=new D(J);H.once("ready",L.resolve);H.on("drop",function(M){K.request("add-file",[M])});H.on("accept",function(M){return K.owner.trigger("dndAccept",M)});H.init();return L.promise()}})});C("lib/filepaste",["base","mediator","runtime/client"],function(E,G,D){var H=E.$;function F(I){I=this.options=H.extend({},I);I.container=H(I.container||document.body);D.call(this,"FilePaste")}E.inherits(D,{constructor:F,init:function(){var I=this;I.connectRuntime(I.options,function(){I.exec("init");I.trigger("ready")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}});G.installTo(F.prototype);return F});C("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(E,D,F){var G=E.$;return D.register({init:function(H){if(!H.paste||this.request("predict-runtime-type")!=="html5"){return}var J=this,K=E.Deferred(),I=G.extend({},{container:H.paste,accept:H.accept}),L;L=new F(I);L.once("ready",K.resolve);L.on("paste",function(M){J.owner.request("add-file",[M])});L.init();return K.promise()}})});C("lib/blob",["base","runtime/client"],function(E,F){function D(G,H){var I=this;I.source=H;I.ruid=G;F.call(I,"Blob");this.uid=H.uid||this.uid;this.type=H.type||"";this.size=H.size||0;if(G){I.connectRuntime(G)}}E.inherits(F,{constructor:D,slice:function(H,G){return this.exec("slice",H,G)},getSource:function(){return this.source}});return D});C("lib/file",["base","lib/blob"],function(F,D){var E=1,G=/\.([^.]+)$/;function H(J,K){var I;D.apply(this,arguments);this.name=K.name||("untitled"+E++);I=G.exec(K.name)?RegExp.$1.toLowerCase():"";if(!I&&this.type){I=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"";this.name+="."+I}if(!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(I)){this.type="image/"+(I==="jpg"?"jpeg":I)}this.ext=I;this.lastModifiedDate=K.lastModifiedDate||(new Date()).toLocaleString()}return F.inherits(D,H)});C("lib/filepicker",["base","runtime/client","lib/file"],function(F,G,H){var D=F.$;function E(I){I=this.options=D.extend({},E.options,I);I.container=D(I.id);if(!I.container.length){throw new Error("按钮指定错误")}I.innerHTML=I.innerHTML||I.label||I.container.html()||"";I.button=D(I.button||document.createElement("div"));I.button.html(I.innerHTML);I.container.html(I.button);G.call(this,"FilePicker",true)}E.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};F.inherits(G,{constructor:E,init:function(){var K=this,J=K.options,I=J.button;I.addClass("webuploader-pick");K.on("all",function(L){var M;switch(L){case"mouseenter":I.addClass("webuploader-pick-hover");break;case"mouseleave":I.removeClass("webuploader-pick-hover");break;case"change":M=K.exec("getFiles");K.trigger("select",D.map(M,function(N){N=new H(K.getRuid(),N);N._refer=J.container;return N}),J.container);break}});K.connectRuntime(J,function(){K.refresh();K.exec("init",J);K.trigger("ready")});D(A).on("resize",function(){K.refresh()})},refresh:function(){var I=this.getRuntime().getContainer(),J=this.options.button,M=J.outerWidth?J.outerWidth():J.width(),L=J.outerHeight?J.outerHeight():J.height(),K=J.offset();M&&L&&I.css({bottom:"auto",right:"auto",width:M+"px",height:L+"px"}).offset(K)},enable:function(){var I=this.options.button;I.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var I=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});I.addClass("webuploader-pick-disable")},destroy:function(){if(this.runtime){this.exec("destroy");this.disconnectRuntime()}}});return E});C("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(F,D,E){var G=F.$;G.extend(D.options,{pick:null,accept:null});return D.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(H){this.pickers=[];return H.pick&&this.addButton(H.pick)},refresh:function(){G.each(this.pickers,function(){this.refresh()})},addButton:function(H){var L=this,I=L.options,N=I.accept,K,M,J;if(!H){return}J=F.Deferred();G.isPlainObject(H)||(H={id:H});K=G.extend({},H,{accept:G.isPlainObject(N)?[N]:N,swf:I.swf,runtimeOrder:I.runtimeOrder});M=new E(K);M.once("ready",J.resolve);M.on("select",function(O){L.owner.request("add-file",[O])});M.init();this.pickers.push(M);return J.promise()},disable:function(){G.each(this.pickers,function(){this.disable()})},enable:function(){G.each(this.pickers,function(){this.enable()})}})});C("lib/image",["base","runtime/client","lib/blob"],function(F,G,D){var H=F.$;function E(I){this.options=H.extend({},E.options,I);G.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}E.options={quality:90,crop:false,preserveHeaders:true,allowMagnify:true};F.inherits(G,{constructor:E,info:function(I){if(I){this._info=I;return this}return this._info},meta:function(I){if(I){this._meta=I;return this}return this._meta},loadFromBlob:function(J){var K=this,I=J.getRuid();this.connectRuntime(I,function(){K.exec("init",K.options);K.exec("loadFromBlob",J)})},resize:function(){var I=F.slice(arguments);return this.exec.apply(this,["resize"].concat(I))},getAsDataUrl:function(I){return this.exec("getAsDataUrl",I)},getAsBlob:function(I){var J=this.exec("getAsBlob",I);return new D(this.getRuid(),J)}});return E});C("widgets/image",["base","uploader","lib/image","widgets/widget"],function(G,E,F){var H=G.$,D;D=(function(L){var J=0,K=[],I=function(){var M;while(K.length&&J<L){M=K.shift();J+=M[0];M[1]()}};return function(N,M,O){K.push([M,O]);N.once("destroy",function(){J-=M;setTimeout(I,1)});setTimeout(I,1)}})(5*1024*1024);H.extend(E.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return E.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(N,I,M,J){var K,L;N=this.request("get-file",N);if(!N.type.match(/^image/)){I(true);return}K=H.extend({},this.options.thumb);if(H.isPlainObject(M)){K=H.extend(K,M);M=null}M=M||K.width;J=J||K.height;L=new F(K);L.once("load",function(){N._info=N._info||L.info();N._meta=N._meta||L.meta();L.resize(M,J)});L.once("complete",function(){I(false,L.getAsDataUrl(K.type));L.destroy()});L.once("error",function(){I(true);L.destroy()});D(L,N.source.size,function(){N._info&&L.info(N._info);N._meta&&L.meta(N._meta);L.loadFromBlob(N.source)})},compressImage:function(M){var I=this.options.compress||this.options.resize,L=I&&I.compressSize||300*1024,J,K;M=this.request("get-file",M);if(!I||!~"image/jpeg,image/jpg".indexOf(M.type)||M.size<L||M._compressed){return}I=H.extend({},I);K=G.Deferred();J=new F(I);K.always(function(){J.destroy();J=null});J.once("error",K.reject);J.once("load",function(){M._info=M._info||J.info();M._meta=M._meta||J.meta();J.resize(I.width,I.height)});J.once("complete",function(){var P,N;try{P=J.getAsBlob(I.type);N=M.size;if(P.size<N){M.source=P;M.size=P.size;M.trigger("resize",P.size,N)}M._compressed=true;K.resolve()}catch(O){K.resolve()}});M._info&&J.info(M._info);M._meta&&J.meta(M._meta);J.loadFromBlob(M.source);return K.promise()}})});C("file",["base","mediator"],function(L,H){var I=L.$,D="WU_FILE_",F=0,K=/\.([^.]+)$/,G={};function J(){return D+F++}function E(M){this.name=M.name||"Untitled";this.size=M.size||0;this.type=M.type||"application";this.lastModifiedDate=M.lastModifiedDate||(new Date()*1);this.id=J();this.ext=K.exec(this.name)?RegExp.$1:"";this.statusText="";G[this.id]=E.Status.INITED;this.source=M;this.loaded=0;this.on("error",function(N){this.setStatus(E.Status.ERROR,N)})}I.extend(E.prototype,{setStatus:function(N,O){var M=G[this.id];typeof O!=="undefined"&&(this.statusText=O);if(N!==M){G[this.id]=N;this.trigger("statuschange",N,M)}},getStatus:function(){return G[this.id]},getSource:function(){return this.source},destory:function(){delete G[this.id]}});H.installTo(E.prototype);E.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return E});C("queue",["base","mediator","file"],function(G,H,F){var I=G.$,E=F.Status;function D(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}I.extend(D.prototype,{append:function(J){this._queue.push(J);this._fileAdded(J);return this},prepend:function(J){this._queue.unshift(J);this._fileAdded(J);return this},getFile:function(J){if(typeof J!=="string"){return J}return this._map[J]},fetch:function(K){var L=this._queue.length,J,M;K=K||E.QUEUED;for(J=0;J<L;J++){M=this._queue[J];if(K===M.getStatus()){return M}}return null},sort:function(J){if(typeof J==="function"){this._queue.sort(J)}},getFiles:function(){var K=[].slice.call(arguments,0),L=[],J=0,M=this._queue.length,N;for(;J<M;J++){N=this._queue[J];if(K.length&&!~I.inArray(N.getStatus(),K)){continue}L.push(N)}return L},_fileAdded:function(L){var J=this,K=this._map[L.id];if(!K){this._map[L.id]=L;L.on("statuschange",function(M,N){J._onFileStatusChange(M,N)})}L.setStatus(E.QUEUED)},_onFileStatusChange:function(K,L){var J=this.stats;switch(L){case E.PROGRESS:J.numOfProgress--;break;case E.QUEUED:J.numOfQueue--;break;case E.ERROR:J.numOfUploadFailed--;break;case E.INVALID:J.numOfInvalid--;break}switch(K){case E.QUEUED:J.numOfQueue++;break;case E.PROGRESS:J.numOfProgress++;break;case E.ERROR:J.numOfUploadFailed++;break;case E.COMPLETE:J.numOfSuccess++;break;case E.CANCELLED:J.numOfCancel++;break;case E.INVALID:J.numOfInvalid++;break}}});H.installTo(D.prototype);return D});C("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(L,E,G,D,H,F){var J=L.$,K=/\.\w+$/,I=D.Status;return E.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile","retry":"retry","reset":"reset","accept-file":"acceptFile"},{init:function(Q){var S=this,R,T,P,U,O,N,M;if(J.isPlainObject(Q.accept)){Q.accept=[Q.accept]}if(Q.accept){O=[];for(P=0,T=Q.accept.length;P<T;P++){U=Q.accept[P].extensions;U&&O.push(U)}if(O.length){N="\\."+O.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}S.accept=new RegExp(N,"i")}S.queue=new G();S.stats=S.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}R=L.Deferred();M=new F("Placeholder");M.connectRuntime({runtimeOrder:"html5"},function(){S._ruid=M.getRuid();R.resolve()});return R.promise()},_wrapFile:function(M){if(!(M instanceof D)){if(!(M instanceof H)){if(!this._ruid){throw new Error("Can't add external files.")}M=new H(this._ruid,M)}M=new D(M)}return M},acceptFile:function(N){var M=!N||N.size<6||this.accept&&K.exec(N.name)&&!this.accept.test(N.name);return !M},_addFile:function(N){var M=this;N=M._wrapFile(N);if(!M.owner.trigger("beforeFileQueued",N)){return}if(!M.acceptFile(N)){M.owner.trigger("error","Q_TYPE_DENIED",N);return}M.queue.append(N);M.owner.trigger("fileQueued",N);return N},getFile:function(M){return this.queue.getFile(M)},addFiles:function(N){var M=this;if(!N.length){N=[N]}N=J.map(N,function(O){return M._addFile(O)});M.owner.trigger("filesQueued",N);if(M.options.auto){M.request("start-upload")}},getStats:function(){return this.stats},removeFile:function(N){var M=this;N=N.id?N:M.queue.getFile(N);N.setStatus(I.CANCELLED);M.owner.trigger("fileDequeued",N)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(R,O){var M=this,Q,N,P;if(R){R=R.id?R:M.queue.getFile(R);R.setStatus(I.QUEUED);O||M.request("start-upload");return}Q=M.queue.getFiles(I.ERROR);N=0;P=Q.length;for(;N<P;N++){R=Q[N];R.setStatus(I.QUEUED)}M.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new G();this.stats=this.queue.stats}})});C("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(D,E){D.support=function(){return E.hasRuntime.apply(E,arguments)};return D.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType()){throw Error("Runtime Error")}},predictRuntmeType:function(){var I=this.options.runtimeOrder||E.orders,F=this.type,G,H;if(!F){I=I.split(/\s*,\s*/g);for(G=0,H=I.length;G<H;G++){if(E.hasRuntime(I[G])){this.type=F=I[G];break}}}return F}})});C("lib/transport",["base","runtime/client","mediator"],function(F,G,D){var H=F.$;function E(I){var J=this;I=J.options=H.extend(true,{},E.options,I||{});G.call(this,"Transport");this._blob=null;this._formData=I.formData||{};this._headers=I.headers||{};this.on("progress",this._timeout);this.on("load error",function(){J.trigger("progress",1);clearTimeout(J._timer)})}E.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};H.extend(E.prototype,{appendBlob:function(I,K,L){var M=this,J=M.options;if(M.getRuid()){M.disconnectRuntime()}M.connectRuntime(K.ruid,function(){M.exec("init")});M._blob=K;J.fileVal=I||J.fileVal;J.filename=L||J.filename},append:function(I,J){if(typeof I==="object"){H.extend(this._formData,I)}else{this._formData[I]=J}},setRequestHeader:function(I,J){if(typeof I==="object"){H.extend(this._headers,I)}else{this._headers[I]=J}},send:function(I){this.exec("send",I);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var I=this,J=I.options.timeout;if(!J){return}clearTimeout(I._timer);I._timer=setTimeout(function(){I.abort();I.trigger("error","timeout")},J)}});D.installTo(E.prototype);return E});C("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(K,E,D,J){var I=K.$,G=K.isPromise,H=D.Status;I.extend(E.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:null});function F(P,R){var O=[],T=P.source,Q=T.size,S=R?Math.ceil(Q/R):1,M=0,N=0,L;while(N<S){L=Math.min(R,Q-M);O.push({file:P,start:M,end:R?(M+L):Q,total:Q,chunks:S,chunk:N++});M+=L}P.blocks=O.concat();P.remaning=O.length;return{file:P,has:function(){return !!O.length},fetch:function(){return O.shift()}}}E.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var L=this.owner;this.runing=false;this.pool=[];this.pending=[];this.remaning=0;this.__tick=K.bindFn(this._tick,this);L.on("uploadComplete",function(M){M.blocks&&I.each(M.blocks,function(O,N){N.transport&&(N.transport.abort(),N.transport.destroy());delete N.transport});delete M.blocks;delete M.remaning})},start:function(){var L=this;I.each(L.request("get-files",H.INVALID),function(){L.request("remove-file",this)});if(L.runing){return}L.runing=true;I.each(L.pool,function(O,M){var N=M.file;if(N.getStatus()===H.INTERRUPT){N.setStatus(H.PROGRESS);L._trigged=false;M.transport&&M.transport.send()}});L._trigged=false;L.owner.trigger("startUpload");K.nextTick(L.__tick)},stop:function(M){var L=this;if(L.runing===false){return}L.runing=false;M&&I.each(L.pool,function(O,N){N.transport&&N.transport.abort();N.file.setStatus(H.INTERRUPT)});L.owner.trigger("stopUpload")},isInProgress:function(){return !!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(M,L){M=this.request("get-file",M);M.setStatus(L||H.COMPLETE);M.skipped=true;M.blocks&&I.each(M.blocks,function(P,O){var N=O.transport;if(N){N.abort();N.destroy();delete O.transport}});this.owner.trigger("uploadSkip",M)},_tick:function(){var N=this,L=N.options,M,O;if(N._promise){return N._promise.always(N.__tick)}if(N.pool.length<L.threads&&(O=N._nextBlock())){N._trigged=false;M=function(P){N._promise=null;P&&P.file&&N._startSend(P);K.nextTick(N.__tick)};N._promise=G(O)?O.always(M):M(O)}else{if(!N.remaning&&!N.getStats().numOfQueue){N.runing=false;N._trigged||K.nextTick(function(){N.owner.trigger("uploadFinished")});N._trigged=true}}},_nextBlock:function(){var P=this,L=P._act,N=P.options,O,M;if(L&&L.has()&&L.file.getStatus()===H.PROGRESS){if(N.prepareNextFile&&!P.pending.length){P._prepareNextFile()}return L.fetch()}else{if(P.runing){if(!P.pending.length&&P.getStats().numOfQueue){P._prepareNextFile()}O=P.pending.shift();M=function(Q){if(!Q){return null}L=F(Q,N.chunked?N.chunkSize:0);P._act=L;return L.fetch()};return G(O)?O[O.pipe?"pipe":"then"](M):M(O)}}},_prepareNextFile:function(){var M=this,N=M.request("fetch-file"),L=M.pending,O;if(N){O=M.request("before-send-file",N,function(){if(N.getStatus()===H.QUEUED){M.owner.trigger("uploadStart",N);N.setStatus(H.PROGRESS);return N}return M._finishFile(N)});O.done(function(){var P=I.inArray(O,L);~P&&L.splice(P,1,N)});O.fail(function(P){N.setStatus(H.ERROR,P);M.owner.trigger("uploadError",N,P);M.owner.trigger("uploadComplete",N)});L.push(O)}},_popBlock:function(M){var L=I.inArray(M,this.pool);this.pool.splice(L,1);M.file.remaning--;this.remaning--},_startSend:function(O){var M=this,N=O.file,L;M.pool.push(O);M.remaning++;O.blob=O.chunks===1?N.source:N.source.slice(O.start,O.end);L=M.request("before-send",O,function(){if(N.getStatus()===H.PROGRESS){M._doSend(O)}else{M._popBlock(O);K.nextTick(M.__tick)}});L.fail(function(){if(N.remaning===1){M._finishFile(N).always(function(){O.percentage=1;M._popBlock(O);M.owner.trigger("uploadComplete",N);K.nextTick(M.__tick)})}else{O.percentage=1;M._popBlock(O);K.nextTick(M.__tick)}})},_doSend:function(Q){var S=this,M=S.owner,R=S.options,O=Q.file,T=new J(R),L=I.extend({},R.formData),P=I.extend({},R.headers),N,U;Q.transport=T;T.on("destroy",function(){delete Q.transport;S._popBlock(Q);K.nextTick(S.__tick)});T.on("progress",function(V){var X=0,W=0;X=Q.percentage=V;if(Q.chunks>1){I.each(O.blocks,function(Z,Y){W+=(Y.percentage||0)*(Y.end-Y.start)});X=W/O.size}M.trigger("uploadProgress",O,X||0)});N=function(V){var W;U=T.getResponseAsJson()||{};U._raw=T.getResponse();W=function(X){V=X};if(!M.trigger("uploadAccept",Q,U,W)){V=V||"server"}return V};T.on("error",function(V,W){Q.retried=Q.retried||0;if(Q.chunks>1&&~"http,abort".indexOf(V)&&Q.retried<R.chunkRetry){Q.retried++;T.send()}else{if(!W&&V==="server"){V=N(V)}O.setStatus(H.ERROR,V);M.trigger("uploadError",O,V);M.trigger("uploadComplete",O)}});T.on("load",function(){var V;if((V=N())){T.trigger("error",V,true);return}if(O.remaning===1){S._finishFile(O,U)}else{T.destroy()}});L=I.extend(L,{id:O.id,name:O.name,type:O.type,lastModifiedDate:O.lastModifiedDate,size:O.size});Q.chunks>1&&I.extend(L,{chunks:Q.chunks,chunk:Q.chunk});M.trigger("uploadBeforeSend",Q,L,P);T.appendBlob(R.fileVal,Q.blob,O.name);T.append(L);T.setRequestHeader(P);T.send()},_finishFile:function(O,M,N){var L=this.owner;return L.request("after-send-file",arguments,function(){O.setStatus(H.COMPLETE);L.trigger("uploadSuccess",O,M,N)}).fail(function(P){if(O.getStatus()===H.PROGRESS){O.setStatus(H.ERROR,P)}L.trigger("uploadError",O,P)}).always(function(){L.trigger("uploadComplete",O)})}})});C("widgets/validator",["base","uploader","file","widgets/widget"],function(G,E,F){var I=G.$,D={},H;H={addValidator:function(J,K){D[J]=K},removeValidator:function(J){delete D[J]}};E.register({init:function(){var J=this;I.each(D,function(){this.call(J.owner)})}});H.addValidator("fileNumLimit",function(){var L=this,K=L.options,J=0,N=K.fileNumLimit>>0,M=true;if(!N){return}L.on("beforeFileQueued",function(O){if(J>=N&&M){M=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",N,O);setTimeout(function(){M=true},1)}return J>=N?false:true});L.on("fileQueued",function(){J++});L.on("fileDequeued",function(){J--});L.on("uploadFinished",function(){J=0})});H.addValidator("fileSizeLimit",function(){var L=this,K=L.options,J=0,N=K.fileSizeLimit>>0,M=true;if(!N){return}L.on("beforeFileQueued",function(P){var O=J+P.size>N;if(O&&M){M=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",N,P);setTimeout(function(){M=true},1)}return O?false:true});L.on("fileQueued",function(O){J+=O.size});L.on("fileDequeued",function(O){J-=O.size});L.on("uploadFinished",function(){J=0})});H.addValidator("fileSingleSizeLimit",function(){var K=this,J=K.options,L=J.fileSingleSizeLimit;if(!L){return}K.on("beforeFileQueued",function(M){if(M.size>L){M.setStatus(F.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",M);return false}})});H.addValidator("duplicate",function(){var M=this,J=M.options,L={};if(J.duplicate){return}function K(Q){var P=0,O=0,R=Q.length,N;for(;O<R;O++){N=Q.charCodeAt(O);P=N+(P<<6)+(P<<16)-P}return P}M.on("beforeFileQueued",function(O){var N=O.__hash||(O.__hash=K(O.name+O.size+O.lastModifiedDate));if(L[N]){this.trigger("error","F_DUPLICATE",O);return false}});M.on("fileQueued",function(O){var N=O.__hash;N&&(L[N]=true)});M.on("fileDequeued",function(O){var N=O.__hash;N&&(delete L[N])})});return H});C("runtime/compbase",[],function(){function D(F,E){this.owner=F;this.options=F.options;this.getRuntime=function(){return E};this.getRuid=function(){return E.uid};this.trigger=function(){return F.trigger.apply(F,arguments)}}return D});C("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(G,E,F){var D="html5",I={};function H(){var J={},K=this,L=this.destory;E.apply(K,arguments);K.type=D;K.exec=function(R,N){var Q=this,O=Q.uid,P=G.slice(arguments,2),M;if(I[R]){M=J[O]=J[O]||new I[R](Q,K);if(M[N]){return M[N].apply(M,P)}}};K.destory=function(){return L&&L.apply(this,arguments)}}G.inherits(E,{constructor:H,init:function(){var J=this;setTimeout(function(){J.trigger("ready")},1)}});H.register=function(K,J){var L=I[K]=G.inherits(F,J);return L};if(A.Blob&&A.FileReader&&A.DataView){E.addRuntime(D,H)}return H});C("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(D,E){return D.register("Blob",{slice:function(H,G){var F=this.owner.source,I=F.slice||F.webkitSlice||F.mozSlice;F=I.call(F,H,G);return new E(this.getRuid(),F)}})});C("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(G,D,H){var E=G.$,F="webuploader-dnd-";return D.register("DragAndDrop",{init:function(){var I=this.elem=this.options.container;this.dragEnterHandler=G.bindFn(this._dragEnterHandler,this);this.dragOverHandler=G.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=G.bindFn(this._dragLeaveHandler,this);this.dropHandler=G.bindFn(this._dropHandler,this);this.dndOver=false;I.on("dragenter",this.dragEnterHandler);I.on("dragover",this.dragOverHandler);I.on("dragleave",this.dragLeaveHandler);I.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){E(document).on("dragover",this.dragOverHandler);E(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(I){var J=this,L=J._denied||false,K;I=I.originalEvent||I;if(!J.dndOver){J.dndOver=true;K=I.dataTransfer.items;if(K&&K.length){J._denied=L=!J.trigger("accept",K)}J.elem.addClass(F+"over");J.elem[L?"addClass":"removeClass"](F+"denied")}I.dataTransfer.dropEffect=L?"none":"copy";return false},_dragOverHandler:function(J){var I=this.elem.parent().get(0);if(I&&!E.contains(I,J.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,J);return false},_dragLeaveHandler:function(){var J=this,I;I=function(){J.dndOver=false;J.elem.removeClass(F+"over "+F+"denied")};clearTimeout(J._leaveTimer);J._leaveTimer=setTimeout(I,100);return false},_dropHandler:function(K){var L=this,J=L.getRuid(),I=L.elem.parent().get(0);if(I&&!E.contains(I,K.currentTarget)){return false}L._getTansferFiles(K,function(M){L.trigger("drop",E.map(M,function(N){return new H(J,N)}))});L.dndOver=false;L.elem.removeClass(F+"over");return false},_getTansferFiles:function(O,L){var Q=[],M=[],S,K,I,N,T,P,R,J;O=O.originalEvent||O;I=O.dataTransfer;S=I.items;K=I.files;J=!!(S&&S[0].webkitGetAsEntry);for(P=0,R=K.length;P<R;P++){N=K[P];T=S&&S[P];if(J&&T.webkitGetAsEntry().isDirectory){M.push(this._traverseDirectoryTree(T.webkitGetAsEntry(),Q))}else{Q.push(N)}}G.when.apply(G,M).done(function(){if(!Q.length){return}L(Q)})},_traverseDirectoryTree:function(J,L){var K=G.Deferred(),I=this;if(J.isFile){J.file(function(M){L.push(M);K.resolve()})}else{if(J.isDirectory){J.createReader().readEntries(function(Q){var P=Q.length,M=[],O=[],N;for(N=0;N<P;N++){M.push(I._traverseDirectoryTree(Q[N],O))}G.when.apply(G,M).then(function(){L.push.apply(L,O);K.resolve()},K.reject)})}}return K.promise()},destroy:function(){var I=this.elem;I.off("dragenter",this.dragEnterHandler);I.off("dragover",this.dragEnterHandler);I.off("dragleave",this.dragLeaveHandler);I.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){E(document).off("dragover",this.dragOverHandler);E(document).off("drop",this.dropHandler)}}})});C("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(E,D,F){return D.register("FilePaste",{init:function(){var H=this.options,J=this.elem=H.container,M=".*",L,G,K,I;if(H.accept){L=[];for(G=0,K=H.accept.length;G<K;G++){I=H.accept[G].mimeTypes;I&&L.push(I)}if(L.length){M=L.join(",");M=M.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=M=new RegExp(M,"i");this.hander=E.bindFn(this._pasteHander,this);J.on("paste",this.hander)},_pasteHander:function(G){var H=[],J=this.getRuid(),L,N,M,I,K;G=G.originalEvent||G;L=G.clipboardData.items;for(I=0,K=L.length;I<K;I++){N=L[I];if(N.kind!=="file"||!(M=N.getAsFile())){continue}H.push(new F(J,M))}if(H.length){G.preventDefault();G.stopPropagation();this.trigger("paste",H)}},destroy:function(){this.elem.off("paste",this.hander)}})});C("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(E,D){var F=E.$;return D.register("FilePicker",{init:function(){var N=this.getRuntime().getContainer(),G=this,I=G.owner,L=G.options,P=F(document.createElement("label")),K=F(document.createElement("input")),O,M,H,J;K.attr("type","file");K.attr("name",L.name);K.addClass("webuploader-element-invisible");P.on("click",function(){K.trigger("click")});P.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(L.multiple){K.attr("multiple","multiple")}if(L.accept&&L.accept.length>0){O=[];for(M=0,H=L.accept.length;M<H;M++){O.push(L.accept[M].mimeTypes)}K.attr("accept",O.join(","))}N.append(K);N.append(P);J=function(Q){I.trigger(Q.type)};K.on("change",function(Q){var S=arguments.callee,R;G.files=Q.target.files;R=this.cloneNode(true);this.parentNode.replaceChild(R,this);K.off();K=F(R).on("change",S).on("mouseenter mouseleave",J);I.trigger("change")});P.on("mouseenter mouseleave",J)},getFiles:function(){return this.files},destroy:function(){}})});C("runtime/html5/util",["base"],function(G){var F=A.createObjectURL&&A||A.URL&&URL.revokeObjectURL&&URL||A.webkitURL,E=G.noop,D=E;if(F){E=function(){return F.createObjectURL.apply(F,arguments)};D=function(){return F.revokeObjectURL.apply(F,arguments)}}return{createObjectURL:E,revokeObjectURL:D,dataURL2Blob:function(H){var M,L,J,I,N,K;K=H.split(",");if(~K[0].indexOf("base64")){M=atob(K[1])}else{M=decodeURIComponent(K[1])}J=new ArrayBuffer(M.length);L=new Uint8Array(J);for(I=0;I<M.length;I++){L[I]=M.charCodeAt(I)}N=K[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(J,N)},dataURL2ArrayBuffer:function(H){var L,K,I,J;J=H.split(",");if(~J[0].indexOf("base64")){L=atob(J[1])}else{L=decodeURIComponent(J[1])}K=new Uint8Array(L.length);for(I=0;I<L.length;I++){K[I]=L.charCodeAt(I)}return K.buffer},arrayBufferToBlob:function(J,H){var I=A.BlobBuilder||A.WebKitBlobBuilder,K;if(I){K=new I();K.append(J);return K.getBlob(H)}return new Blob([J],H?{type:H}:{})},canvasToDataUrl:function(I,H,J){return I.toDataURL(H,J/100)},parseMeta:function(I,H){H(false,{})},updateImageHead:function(H){return H}}});C("runtime/html5/imagemeta",["runtime/html5/util"],function(D){var E;E={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(G,F){var H=this,I=new FileReader();I.onload=function(){F(false,H._parse(this.result));I=I.onload=I.onerror=null};I.onerror=function(J){F(J.message);I=I.onload=I.onerror=null};G=G.slice(0,H.maxMetaDataSize);I.readAsArrayBuffer(G.getSource())},_parse:function(N,K){if(N.byteLength<6){return}var F=new DataView(N),H=2,L=F.byteLength-4,G=H,P={},M,O,I,J;if(F.getUint16(0)===65496){while(H<L){M=F.getUint16(H);if(M>=65504&&M<=65519||M===65534){O=F.getUint16(H+2)+2;if(H+O>F.byteLength){break}I=E.parsers[M];if(!K&&I){for(J=0;J<I.length;J+=1){I[J].call(E,F,H,O,P)}}H+=O;G=H}else{break}}if(G>6){if(N.slice){P.imageHead=N.slice(2,G)}else{P.imageHead=new Uint8Array(N).subarray(2,G)}}}return P},updateImageHead:function(G,I){var K=this._parse(G,true),H,J,F;F=2;if(K.imageHead){F=2+K.imageHead.byteLength}if(G.slice){J=G.slice(F)}else{J=new Uint8Array(G).subarray(F)}H=new Uint8Array(I.byteLength+2+J.byteLength);H[0]=255;H[1]=216;H.set(new Uint8Array(I),2);H.set(new Uint8Array(J),I.byteLength+2);return H.buffer}};D.parseMeta=function(){return E.parse.apply(E,arguments)};D.updateImageHead=function(){return E.updateImageHead.apply(E,arguments)};return E});C("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(E,D){var F={};F.ExifMap=function(){return this};F.ExifMap.prototype.map={"Orientation":274};F.ExifMap.prototype.get=function(G){return this[G]||this[this.map[G]]};F.exifTagTypes={1:{getValue:function(G,H){return G.getUint8(H)},size:1},2:{getValue:function(G,H){return String.fromCharCode(G.getUint8(H))},size:1,ascii:true},3:{getValue:function(G,H,I){return G.getUint16(H,I)},size:2},4:{getValue:function(G,H,I){return G.getUint32(H,I)},size:4},5:{getValue:function(G,H,I){return G.getUint32(H,I)/G.getUint32(H+4,I)},size:8},9:{getValue:function(G,H,I){return G.getInt32(H,I)},size:4},10:{getValue:function(G,H,I){return G.getInt32(H,I)/G.getInt32(H+4,I)},size:8}};F.exifTagTypes[7]=F.exifTagTypes[1];F.getExifValue=function(S,L,I,Q,K,O){var G=F.exifTagTypes[Q],R,H,M,N,J,P;if(!G){E.log("Invalid Exif data: Invalid tag type.");return}R=G.size*K;H=R>4?L+S.getUint32(I+8,O):(I+8);if(H+R>S.byteLength){E.log("Invalid Exif data: Invalid data offset.");return}if(K===1){return G.getValue(S,H,O)}M=[];for(N=0;N<K;N+=1){M[N]=G.getValue(S,H+N*G.size,O)}if(G.ascii){J="";for(N=0;N<M.length;N+=1){P=M[N];if(P==="\u0000"){break}J+=P}return J}return M};F.parseExifTag=function(I,J,H,K,L){var G=I.getUint16(H,K);L.exif[G]=F.getExifValue(I,J,H,I.getUint16(H+2,K),I.getUint32(H+4,K),K)};F.parseExifTags=function(M,J,H,L,G){var N,I,K;if(H+6>M.byteLength){E.log("Invalid Exif data: Invalid directory offset.");return}N=M.getUint16(H,L);I=H+2+12*N;if(I+4>M.byteLength){E.log("Invalid Exif data: Invalid directory size.");return}for(K=0;K<N;K+=1){this.parseExifTag(M,J,H+2+12*K,L,G)}return M.getUint32(I,L)};F.parseExifData=function(J,G,H,M){var K=G+10,L,I;if(J.getUint32(G+4)!==1165519206){return}if(K+8>J.byteLength){E.log("Invalid Exif data: Invalid segment size.");return}if(J.getUint16(G+8)!==0){E.log("Invalid Exif data: Missing byte alignment offset.");return}switch(J.getUint16(K)){case 18761:L=true;break;case 19789:L=false;break;default:E.log("Invalid Exif data: Invalid byte alignment marker.");return}if(J.getUint16(K+2,L)!==42){E.log("Invalid Exif data: Missing TIFF marker.");return}I=J.getUint32(K+4,L);M.exif=new F.ExifMap();I=F.parseExifTags(J,K,K+I,L,M)};D.parsers[65505].push(F.parseExifData);return F});C("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(G,D,E){var F="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return D.register("Image",{modified:false,init:function(){var H=this,I=new Image();I.onload=function(){H._info={type:H.type,width:this.width,height:this.height};if(!H._metas&&"image/jpeg"===H.type){E.parseMeta(H._blob,function(K,J){H._metas=J;H.owner.trigger("load")})}else{H.owner.trigger("load")}};I.onerror=function(){H.owner.trigger("error")};H._img=I},loadFromBlob:function(H){var I=this,J=I._img;I._blob=H;I.type=H.type;J.src=E.createObjectURL(H.getSource());I.owner.once("load",function(){E.revokeObjectURL(J.src)})},resize:function(J,H){var I=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,I,J,H);this._blob=null;this.modified=true;this.owner.trigger("complete")},getAsBlob:function(H){var J=this._blob,I=this.options,K;H=H||this.type;if(this.modified||this.type!==H){K=this._canvas;if(H==="image/jpeg"){J=E.canvasToDataUrl(K,"image/jpeg",I.quality);if(I.preserveHeaders&&this._metas&&this._metas.imageHead){J=E.dataURL2ArrayBuffer(J);J=E.updateImageHead(J,this._metas.imageHead);J=E.arrayBufferToBlob(J,H);return J}}else{J=E.canvasToDataUrl(K,H)}J=E.dataURL2Blob(J)}return J},getAsDataUrl:function(H){var I=this.options;H=H||this.type;if(H==="image/jpeg"){return E.canvasToDataUrl(this._canvas,H,I.quality)}else{return this._canvas.toDataURL(H)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(H){if(H){this._info=H;return this}return this._info},meta:function(H){if(H){this._meta=H;return this}return this._meta},destroy:function(){var H=this._canvas;this._img.onload=null;if(H){H.getContext("2d").clearRect(0,0,H.width,H.height);H.width=H.height=0;this._canvas=null}this._img.src=F;this._img=this._blob=null},_resize:function(I,S,P,T){var N=this.options,Q=I.width,H=I.height,M=this.getOrientation(),J,L,O,K,R;if(~[5,6,7,8].indexOf(M)){P^=T;T^=P;P^=T}J=Math[N.crop?"max":"min"](P/Q,T/H);N.allowMagnify||(J=Math.min(1,J));L=Q*J;O=H*J;if(N.crop){S.width=P;S.height=T}else{S.width=L;S.height=O}K=(S.width-L)/2;R=(S.height-O)/2;N.preserveHeaders||this._rotate2Orientaion(S,M);this._renderImageToCanvas(S,I,K,R,L,O)},_rotate2Orientaion:function(J,H){var K=J.width,I=J.height,L=J.getContext("2d");switch(H){case 5:case 6:case 7:case 8:J.width=I;J.height=K;break}switch(H){case 2:L.translate(K,0);L.scale(-1,1);break;case 3:L.translate(K,I);L.rotate(Math.PI);break;case 4:L.translate(0,I);L.scale(1,-1);break;case 5:L.rotate(0.5*Math.PI);L.scale(1,-1);break;case 6:L.rotate(0.5*Math.PI);L.translate(0,-I);break;case 7:L.rotate(0.5*Math.PI);L.translate(K,-I);L.scale(-1,1);break;case 8:L.rotate(-0.5*Math.PI);L.translate(-K,0);break}},_renderImageToCanvas:(function(){if(!G.os.ios){return function(K,O,L,M,N,J){K.getContext("2d").drawImage(O,L,M,N,J)}}function I(K,P,L){var J=document.createElement("canvas"),O=J.getContext("2d"),R=0,Q=L,S=L,M,N,T;J.width=1;J.height=L;O.drawImage(K,0,0);M=O.getImageData(0,0,1,L).data;while(S>R){N=M[(S-1)*4+3];if(N===0){Q=S}else{R=S}S=(Q+R)>>1}T=(S/L);return(T===0)?1:T}if(G.os.ios>=7){return function(J,K,P,Q,M,N){var O=K.naturalWidth,L=K.naturalHeight,R=I(K,O,L);return J.getContext("2d").drawImage(K,0,0,O*R,L*R,P,Q,M,N)}}function H(M){var N=M.naturalWidth,J=M.naturalHeight,K,L;if(N*J>1024*1024){K=document.createElement("canvas");K.width=K.height=1;L=K.getContext("2d");L.drawImage(M,-N+1,0);return L.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(J,e,a,b,T,c){var R=e.naturalWidth,M=e.naturalHeight,N=J.getContext("2d"),Z=H(e),P=this.type==="image/jpeg",O=1024,L=0,W=0,V,U,Q,X,S,Y,K;if(Z){R/=2;M/=2}N.save();V=document.createElement("canvas");V.width=V.height=O;U=V.getContext("2d");Q=P?I(e,R,M):1;X=Math.ceil(O*T/R);S=Math.ceil(O*c/M/Q);while(L<M){Y=0;K=0;while(Y<R){U.clearRect(0,0,O,O);U.drawImage(e,-Y,-L);N.drawImage(V,0,0,O,O,a+K,b+W,X,S);Y+=O;K+=X}L+=O;W+=S}N.restore();V=U=null}})()})});C("runtime/html5/transport",["base","runtime/html5/runtime"],function(E,D){var F=E.noop,G=E.$;return D.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var H=this.owner,K=this.options,I=this._initAjax(),O=H._blob,L=K.server,N,M,J;if(K.sendAsBinary){L+=(/\?/.test(L)?"&":"?")+G.param(H._formData);M=O.getSource()}else{N=new FormData();G.each(H._formData,function(Q,P){N.append(Q,P)});N.append(K.fileVal,O.getSource(),K.filename||H._formData.name||"")}if(K.withCredentials&&"withCredentials" in I){I.open(K.method,L,true);I.withCredentials=true}else{I.open(K.method,L)}this._setRequestHeader(I,K.headers);if(M){I.overrideMimeType("application/octet-stream");if(E.os.android){J=new FileReader();J.onload=function(){I.send(this.result);J=J.onload=null};J.readAsArrayBuffer(M)}else{I.send(M)}}else{I.send(N)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var H=this._xhr;if(H){H.upload.onprogress=F;H.onreadystatechange=F;H.abort();this._xhr=H=null}},destroy:function(){this.abort()},_initAjax:function(){var I=this,J=new XMLHttpRequest(),H=this.options;if(H.withCredentials&&!("withCredentials" in J)&&typeof XDomainRequest!=="undefined"){J=new XDomainRequest()}J.upload.onprogress=function(K){var L=0;if(K.lengthComputable){L=K.loaded/K.total}return I.trigger("progress",L)};J.onreadystatechange=function(){if(J.readyState!==4){return}J.upload.onprogress=F;J.onreadystatechange=F;I._xhr=null;I._status=J.status;if(J.status>=200&&J.status<300){I._response=J.responseText;return I.trigger("load")}else{if(J.status>=500&&J.status<600){I._response=J.responseText;return I.trigger("error","server")}}return I.trigger("error",I._status?"http":"abort")};I._xhr=J;return J},_setRequestHeader:function(I,H){G.each(H,function(J,K){I.setRequestHeader(J,K)})},_parseJson:function(J){var H;try{H=JSON.parse(J)}catch(I){H={}}return H}})});C("preset/html5only",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/image","runtime/html5/transport"],function(D){return D});C("webuploader",["preset/html5only"],function(D){return D});return B("webuploader")});