/*
 * Bootstrap Grunt task for parsing Less docstrings
 * http://getbootstrap.com
 * Copyright 2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
"use strict";var Remarkable=require("remarkable");function markdown2html(A){var B=new Remarkable();return B.render(A.trim()).slice(3,-5)}var CUSTOMIZABLE_HEADING=/^[/]{2}={2}(.*)$/;var UNCUSTOMIZABLE_HEADING=/^[/]{2}-{2}(.*)$/;var SUBSECTION_HEADING=/^[/]{2}={3}(.*)$/;var SECTION_DOCSTRING=/^[/]{2}#{2}(.+)$/;var VAR_ASSIGNMENT=/^(@[a-zA-Z0-9_-]+):[ ]*([^ ;][^;]*);[ ]*$/;var VAR_DOCSTRING=/^[/]{2}[*]{2}(.+)$/;function Section(B,A){this.heading=B.trim();this.id=this.heading.replace(/\s+/g,"-").toLowerCase();this.customizable=A;this.docstring=null;this.subsections=[]}Section.prototype.addSubSection=function(A){this.subsections.push(A)};function SubSection(A){this.heading=A.trim();this.id=this.heading.replace(/\s+/g,"-").toLowerCase();this.variables=[]}SubSection.prototype.addVar=function(A){this.variables.push(A)};function VarDocstring(A){this.html=markdown2html(A)}function SectionDocstring(A){this.html=markdown2html(A)}function Variable(A,B){this.name=A;this.defaultValue=B;this.docstring=null}function Tokenizer(A){this._lines=A.split("\n");this._next=undefined}Tokenizer.prototype.unshift=function(A){if(this._next!==undefined){throw new Error("Attempted to unshift twice!")}this._next=A};Tokenizer.prototype._shift=function(){if(this._next!==undefined){var C=this._next;this._next=undefined;return C}if(this._lines.length<=0){return null}var E=this._lines.shift();var B=null;B=SUBSECTION_HEADING.exec(E);if(B!==null){return new SubSection(B[1])}B=CUSTOMIZABLE_HEADING.exec(E);if(B!==null){return new Section(B[1],true)}B=UNCUSTOMIZABLE_HEADING.exec(E);if(B!==null){return new Section(B[1],false)}B=SECTION_DOCSTRING.exec(E);if(B!==null){return new SectionDocstring(B[1])}B=VAR_DOCSTRING.exec(E);if(B!==null){return new VarDocstring(B[1])}var A=E.lastIndexOf("//");var D=(A===-1)?E:E.slice(0,A);B=VAR_ASSIGNMENT.exec(D);if(B!==null){return new Variable(B[1],B[2])}return undefined};Tokenizer.prototype.shift=function(){while(true){var A=this._shift();if(A===undefined){continue}return A}};function Parser(A){this._tokenizer=new Tokenizer(A)}Parser.prototype.parseFile=function(){var B=[];while(true){var A=this.parseSection();if(A===null){if(this._tokenizer.shift()!==null){throw new Error("Unexpected unparsed section of file remains!")}return B}B.push(A)}};Parser.prototype.parseSection=function(){var B=this._tokenizer.shift();if(B===null){return null}if(!(B instanceof Section)){throw new Error("Expected section heading; got: "+JSON.stringify(B))}var A=this._tokenizer.shift();if(A instanceof SectionDocstring){B.docstring=A}else{this._tokenizer.unshift(A)}this.parseSubSections(B);return B};Parser.prototype.parseSubSections=function(A){while(true){var B=this.parseSubSection();if(B===null){if(A.subsections.length===0){B=new SubSection("");this.parseVars(B)}else{break}}A.addSubSection(B)}if(A.subsections.length===1&&!(A.subsections[0].heading)&&A.subsections[0].variables.length===0){A.subsections=[]}};Parser.prototype.parseSubSection=function(){var A=this._tokenizer.shift();if(A instanceof SubSection){this.parseVars(A);return A}this._tokenizer.unshift(A);return null};Parser.prototype.parseVars=function(B){while(true){var A=this.parseVar();if(A===null){return}B.addVar(A)}};Parser.prototype.parseVar=function(){var B=this._tokenizer.shift();if(!(B instanceof VarDocstring)){this._tokenizer.unshift(B);B=null}var A=this._tokenizer.shift();if(A instanceof Variable){A.docstring=B;return A}this._tokenizer.unshift(A);return null};module.exports=Parser;