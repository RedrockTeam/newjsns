(function(G){var D={canvas:true};var C,B,F;var E=Object.prototype.hasOwnProperty;function A(H,J){var I=J.Canvas;if(C==null){B=I.prototype.getTextInfo,F=I.prototype.addText,C=I.prototype.render}I.prototype.render=function(){if(!H.getOptions().canvas){return C.call(this)}var P=this.context,W=this._textCache;P.save();P.textBaseline="middle";for(var N in W){if(E.call(W,N)){var L=W[N];for(var T in L){if(E.call(L,T)){var V=L[T],S=true;for(var R in V){if(E.call(V,R)){var U=V[R],M=U.positions,Y=U.lines;if(S){P.fillStyle=U.font.color;P.font=U.font.definition;S=false}for(var Q=0,O;O=M[Q];Q++){if(O.active){for(var K=0,X;X=O.lines[K];K++){P.fillText(Y[K].text,X[0],X[1])}}else{M.splice(Q--,1)}}if(M.length==0){delete V[R]}}}}}}}P.restore()};I.prototype.getTextInfo=function(Y,T,N,V,U){if(!H.getOptions().canvas){return B.call(this,Y,T,N,V,U)}var R,K,W,X;T=""+T;if(typeof N==="object"){R=N.style+" "+N.variant+" "+N.weight+" "+N.size+"px "+N.family}else{R=N}K=this._textCache[Y];if(K==null){K=this._textCache[Y]={}}W=K[R];if(W==null){W=K[R]={}}X=W[T];if(X==null){var Q=this.context;if(typeof N!=="object"){var L=G("<div>&nbsp;</div>").css("position","absolute").addClass(typeof N==="string"?N:null).appendTo(this.getTextLayer(Y));N={lineHeight:L.height(),style:L.css("font-style"),variant:L.css("font-variant"),weight:L.css("font-weight"),family:L.css("font-family"),color:L.css("color")};N.size=L.css("line-height",1).height();L.remove()}R=N.style+" "+N.variant+" "+N.weight+" "+N.size+"px "+N.family;X=W[T]={width:0,height:0,positions:[],lines:[],font:{definition:R,color:N.color}};Q.save();Q.font=R;var O=(T+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var S=0;S<O.length;++S){var P=O[S],M=Q.measureText(P);X.width=Math.max(M.width,X.width);X.height+=N.lineHeight;X.lines.push({text:P,width:M.width,height:N.lineHeight})}Q.restore()}return X};I.prototype.addText=function(Y,V,W,R,N,U,T,L,K){if(!H.getOptions().canvas){return F.call(this,Y,V,W,R,N,U,T,L,K)}var X=this.getTextInfo(Y,R,N,U,T),M=X.positions,O=X.lines;W+=X.height/O.length/2;if(K=="middle"){W=Math.round(W-X.height/2)}else{if(K=="bottom"){W=Math.round(W-X.height)}else{W=Math.round(W)}}if(!!(window.opera&&window.opera.version().split(".")[0]<12)){W-=2}for(var P=0,S;S=M[P];P++){if(S.x==V&&S.y==W){S.active=true;return}}S={active:true,lines:[],x:V,y:W};M.push(S);for(var P=0,Q;Q=O[P];P++){if(L=="center"){S.lines.push([Math.round(V-Q.width/2),W])}else{if(L=="right"){S.lines.push([Math.round(V-Q.width),W])}else{S.lines.push([Math.round(V),W])}}W+=Q.height}}}G.plot.plugins.push({init:A,options:D,name:"canvas",version:"1.0"})})(jQuery);