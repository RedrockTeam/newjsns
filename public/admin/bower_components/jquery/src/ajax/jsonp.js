define(["../core","./var/nonce","./var/rquery","../ajax"],function(D,B,A){var C=[],E=/(=)\?(?=&|$)|\?\?/;D.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var F=C.pop()||(D.expando+"_"+(B++));this[F]=true;return F}});D.ajaxPrefilter("json jsonp",function(H,L,G){var F,J,I,K=H.jsonp!==false&&(E.test(H.url)?"url":typeof H.data==="string"&&!(H.contentType||"").indexOf("application/x-www-form-urlencoded")&&E.test(H.data)&&"data");if(K||H.dataTypes[0]==="jsonp"){F=H.jsonpCallback=D.isFunction(H.jsonpCallback)?H.jsonpCallback():H.jsonpCallback;if(K){H[K]=H[K].replace(E,"$1"+F)}else{if(H.jsonp!==false){H.url+=(A.test(H.url)?"&":"?")+H.jsonp+"="+F}}H.converters["script json"]=function(){if(!I){D.error(F+" was not called")}return I[0]};H.dataTypes[0]="json";J=window[F];window[F]=function(){I=arguments};G.always(function(){window[F]=J;if(H[F]){H.jsonpCallback=L.jsonpCallback;C.push(F)}if(I&&D.isFunction(J)){J(I[0])}I=J=undefined});return"script"}})});